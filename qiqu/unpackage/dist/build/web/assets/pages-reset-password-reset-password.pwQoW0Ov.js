import{_ as e,a,x as o,y as s,D as l,d as t,w as n,i as r,o as i,e as c,f as d,m,t as u,k as f,I as h,A as p}from"./index-DfJFPZaM.js";import{s as w,a as _}from"./user.C6GM3hFr.js";import"./request.D0Ryayp7.js";const V=e({data:()=>({form:{username:"",email:"",emailCode:"",newPassword:"",confirmPassword:""},counting:!1,countdown:60}),methods:{async sendCode(){if(!this.counting){if(!this.form.username)return a({title:"请输入用户名",icon:"none"});if(!this.form.email)return a({title:"请输入邮箱",icon:"none"});try{o({title:"发送中"});const e=await w({username:this.form.username,email:this.form.email});if(s(),1!==e.code)throw new Error(e.message||"发送失败");{a({title:"验证码已发送",icon:"success"}),this.counting=!0,this.countdown=60;const e=setInterval((()=>{this.countdown>0?this.countdown--:(this.counting=!1,clearInterval(e))}),1e3)}}catch(e){s(),console.error("发送验证码失败:",e),a({title:e.message||"发送失败",icon:"none"})}}},async handleSubmit(){if(!this.form.username)return a({title:"请输入用户名",icon:"none"});if(!this.form.emailCode)return a({title:"请输入验证码",icon:"none"});if(!this.form.newPassword)return a({title:"请输入新密码",icon:"none"});if(!this.form.confirmPassword)return a({title:"请确认新密码",icon:"none"});if(this.form.newPassword!==this.form.confirmPassword)return a({title:"两次输入的密码不一致",icon:"none"});try{o({title:"提交中"});const e=await _({username:this.form.username,newPassword:this.form.newPassword,emailCode:this.form.emailCode});if(s(),1!==e.code)throw new Error(e.message||"重置失败");a({title:"重置成功",icon:"success"}),setTimeout((()=>{l()}),1500)}catch(e){s(),console.error("重置密码失败:",e),a({title:e.message||"重置失败",icon:"none"})}},goBack(){l()}}},[["render",function(e,a,o,s,l,w){const _=f,V=h,C=r,b=p;return i(),t(C,{class:"container"},{default:n((()=>[c(C,{class:"form"},{default:n((()=>[c(C,{class:"form-item"},{default:n((()=>[c(_,{class:"label"},{default:n((()=>[d("用户名")])),_:1}),c(V,{type:"text",modelValue:l.form.username,"onUpdate:modelValue":a[0]||(a[0]=e=>l.form.username=e),placeholder:"请输入用户名","placeholder-class":"placeholder"},null,8,["modelValue"])])),_:1}),c(C,{class:"form-item"},{default:n((()=>[c(_,{class:"label"},{default:n((()=>[d("邮箱")])),_:1}),c(V,{type:"text",modelValue:l.form.email,"onUpdate:modelValue":a[1]||(a[1]=e=>l.form.email=e),placeholder:"请输入邮箱","placeholder-class":"placeholder"},null,8,["modelValue"])])),_:1}),c(C,{class:"form-item"},{default:n((()=>[c(_,{class:"label"},{default:n((()=>[d("验证码")])),_:1}),c(C,{class:"code-input"},{default:n((()=>[c(V,{type:"text",modelValue:l.form.emailCode,"onUpdate:modelValue":a[2]||(a[2]=e=>l.form.emailCode=e),placeholder:"请输入验证码","placeholder-class":"placeholder"},null,8,["modelValue"]),c(_,{class:m(["code-btn",{disabled:l.counting}]),onClick:w.sendCode},{default:n((()=>[d(u(l.counting?`${l.countdown}s后重发`:"获取验证码"),1)])),_:1},8,["class","onClick"])])),_:1})])),_:1}),c(C,{class:"form-item"},{default:n((()=>[c(_,{class:"label"},{default:n((()=>[d("新密码")])),_:1}),c(V,{type:"password",modelValue:l.form.newPassword,"onUpdate:modelValue":a[3]||(a[3]=e=>l.form.newPassword=e),placeholder:"请输入新密码","placeholder-class":"placeholder"},null,8,["modelValue"])])),_:1}),c(C,{class:"form-item"},{default:n((()=>[c(_,{class:"label"},{default:n((()=>[d("确认密码")])),_:1}),c(V,{type:"password",modelValue:l.form.confirmPassword,"onUpdate:modelValue":a[4]||(a[4]=e=>l.form.confirmPassword=e),placeholder:"请再次输入新密码","placeholder-class":"placeholder"},null,8,["modelValue"])])),_:1}),c(C,{class:"tips"},{default:n((()=>[c(_,{class:"tip-item"},{default:n((()=>[d("密码长度为6-20位")])),_:1}),c(_,{class:"tip-item"},{default:n((()=>[d("必须包含字母和数字")])),_:1})])),_:1})])),_:1}),c(C,{class:"actions"},{default:n((()=>[c(b,{class:"submit-btn",onClick:w.handleSubmit},{default:n((()=>[d("重置密码")])),_:1},8,["onClick"]),c(C,{class:"back-btn",onClick:w.goBack},{default:n((()=>[d("返回登录")])),_:1},8,["onClick"])])),_:1})])),_:1})}],["__scopeId","data-v-e33597e4"]]);export{V as default};
