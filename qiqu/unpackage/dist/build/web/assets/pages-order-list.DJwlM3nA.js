import{_ as t,H as e,s as a,x as s,a as l,y as r,z as o,J as n,K as u,D as c,C as i,d,w as h,i as p,o as g,e as f,L as m,f as y,h as _,j as k,F as S,v,k as H,p as B,l as w,m as C,t as O,A as x}from"./index-DfJFPZaM.js";import{g as b,a as D}from"./order.CGxIaE0u.js";import"./request.D0Ryayp7.js";const A=t({data:()=>({statusList:[{name:"全部",value:""},{name:"待付款",value:"待付款"},{name:"待发货",value:"待发货"},{name:"已发货",value:"已发货"},{name:"已完成",value:"已完成"},{name:"已过期",value:"已过期"}],currentStatus:"",orderList:[],page:1,pageSize:10,hasMore:!0,scrollHeight:0,statusBarHeight:0,navBarHeight:0,menuHeight:44}),onLoad(t){this.currentStatus=t.status||"";const a=e();this.statusBarHeight=a.statusBarHeight,this.navBarHeight=this.statusBarHeight+this.menuHeight,this.scrollHeight=a.windowHeight-this.navBarHeight-100,this.loadOrders()},onPullDownRefresh(){this.page=1,this.loadOrders().then((()=>{a()}))},methods:{async loadOrders(){try{s({title:"加载中"});const t=this.currentStatus?await b(this.currentStatus):await D();if(1!==t.code)throw new Error(t.message||"获取订单列表失败");this.orderList=t.data||[]}catch(t){console.error("获取订单列表失败:",t),l({title:t.message||"获取订单列表失败",icon:"none"})}finally{r()}},changeStatus(t){this.currentStatus!==t&&(this.currentStatus=t,this.orderList=[],this.loadOrders())},loadMore(){this.hasMore&&(this.page++,this.loadOrders())},handleDelete(t){o({title:"提示",content:"确定要删除该订单吗？",success:async e=>{if(e.confirm)try{1===(await deleteOrder(t.id)).code&&(l({title:"删除成功",icon:"success"}),this.page=1,this.loadOrders())}catch(a){console.error("删除订单失败:",a),l({title:"删除失败",icon:"none"})}}})},handleBuyAgain(t){},formatDate(t){if(!t)return"";const e=new Date(t);return`${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,"0")}-${String(e.getDate()).padStart(2,"0")} ${String(e.getHours()).padStart(2,"0")}:${String(e.getMinutes()).padStart(2,"0")}`},getTotalCount:t=>Array.isArray(t)?t.reduce(((t,e)=>t+(e.count||0)),0):0,copyOrderNo(t){n({data:t,success:()=>{l({title:"订单号已复制",icon:"none"})}})},goBack(){u().length>1?c():i({url:"/pages/mall/mall"})},getOrderStatus(t){if("待付款"===t.status){const e=new Date(t.createdAt).getTime();if((new Date).getTime()-e>18e5)return"订单已过期"}return t.status},onBackPress:()=>(i({url:"/pages/mall/mall"}),!0)},onUnload(){document.documentElement.style.removeProperty("--custom-nav-height")},computed:{statusTabStyle(){return{top:this.navBarHeight+"px"}},listStyle(){return{paddingTop:this.navBarHeight+100+"px"}}}},[["render",function(t,e,a,s,l,r){const o=p,n=H,u=B,c=x,i=w;return g(),d(o,{class:"container"},{default:h((()=>[f(o,{class:"custom-nav",style:m({height:l.navBarHeight+"px"})},{default:h((()=>[f(o,{class:"nav-content",style:m({height:l.menuHeight+"px",top:l.statusBarHeight+"px"})},{default:h((()=>[f(o,{class:"back-icon",onClick:r.goBack},null,8,["onClick"]),f(n,{class:"title"},{default:h((()=>[y("订单列表")])),_:1})])),_:1},8,["style"])])),_:1},8,["style"]),f(o,{class:"status-tabs",style:m(r.statusTabStyle)},{default:h((()=>[(g(!0),_(S,null,k(l.statusList,((t,e)=>(g(),d(o,{class:C(["tab-item",{active:l.currentStatus===t.value}]),key:e,onClick:e=>r.changeStatus(t.value)},{default:h((()=>[f(n,null,{default:h((()=>[y(O(t.name),1)])),_:2},1024)])),_:2},1032,["class","onClick"])))),128))])),_:1},8,["style"]),f(i,{class:"order-list","scroll-y":"",onScrolltolower:r.loadMore,style:m(r.listStyle)},{default:h((()=>[(g(!0),_(S,null,k(l.orderList,((t,e)=>(g(),d(o,{class:"order-item",key:e},{default:h((()=>[f(o,{class:"order-content"},{default:h((()=>[f(o,{class:"shop-info"},{default:h((()=>[f(n,{class:"shop-name"},{default:h((()=>[y("在线书城")])),_:1}),f(n,{class:"order-time"},{default:h((()=>[y(O(r.formatDate(t.createdAt)),1)])),_:2},1024)])),_:2},1024),f(o,{class:"order-no"},{default:h((()=>[f(n,null,{default:h((()=>[y("订单编号：")])),_:1}),f(n,{class:"number",onClick:e=>r.copyOrderNo(t.id)},{default:h((()=>[y(O(t.id),1)])),_:2},1032,["onClick"]),f(n,{class:"copy-btn",onClick:e=>r.copyOrderNo(t.id)},{default:h((()=>[y("复制")])),_:2},1032,["onClick"])])),_:2},1024),(g(!0),_(S,null,k(t.products,((t,e)=>(g(),d(o,{class:"product-item",key:e},{default:h((()=>[f(u,{src:t.image,mode:"aspectFill",class:"product-image"},null,8,["src"]),f(o,{class:"product-info"},{default:h((()=>[f(n,{class:"product-name"},{default:h((()=>[y(O(t.name),1)])),_:2},1024),f(o,{class:"product-price-wrap"},{default:h((()=>[f(n,{class:"product-price"},{default:h((()=>[y("¥"+O(t.price),1)])),_:2},1024),f(n,{class:"product-count"},{default:h((()=>[y("x"+O(t.count),1)])),_:2},1024)])),_:2},1024)])),_:2},1024)])),_:2},1024)))),128)),f(o,{class:"delivery-info"},{default:h((()=>[f(n,{class:"type"},{default:h((()=>[y(O("express"===t.deliveryType?"快递配送":"自提"),1)])),_:2},1024),"express"===t.deliveryType?(g(),d(n,{key:0,class:"address"},{default:h((()=>[y(O(t.address),1)])),_:2},1024)):(g(),d(n,{key:1,class:"address"},{default:h((()=>[y(O(t.pickupAddress),1)])),_:2},1024))])),_:2},1024),f(o,{class:"order-amount"},{default:h((()=>[f(n,null,{default:h((()=>[y("共"+O(r.getTotalCount(t.products))+"件商品",1)])),_:2},1024),f(n,{class:"amount"},{default:h((()=>[y("实付：¥"+O(t.totalAmount),1)])),_:2},1024)])),_:2},1024),f(o,{class:"order-footer"},{default:h((()=>[f(n,{class:"status"},{default:h((()=>[y(O(r.getOrderStatus(t)),1)])),_:2},1024),f(o,{class:"buttons"},{default:h((()=>["已完成"===t.status?(g(),d(c,{key:0,class:"btn outline",onClick:e=>r.handleBuyAgain(t)},{default:h((()=>[y("再次购买")])),_:2},1032,["onClick"])):v("",!0),"已完成"===t.status?(g(),d(c,{key:1,class:"btn outline",onClick:e=>r.handleDelete(t)},{default:h((()=>[y("删除订单")])),_:2},1032,["onClick"])):v("",!0)])),_:2},1024)])),_:2},1024)])),_:2},1024)])),_:2},1024)))),128)),l.hasMore?(g(),d(o,{key:0,class:"load-more"},{default:h((()=>[f(n,null,{default:h((()=>[y("加载中...")])),_:1})])),_:1})):v("",!0),0===l.orderList.length?(g(),d(o,{key:1,class:"empty"},{default:h((()=>[f(u,{src:"/static/images/empty-order.png",mode:"aspectFit",class:"empty-image"}),f(n,null,{default:h((()=>[y("暂无相关订单")])),_:1})])),_:1})):v("",!0)])),_:1},8,["onScrolltolower","style"])])),_:1})}],["__scopeId","data-v-e41c427e"]]);export{A as default};
