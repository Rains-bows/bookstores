import{_ as a,D as t,a as s,c as e,b as o,n as c,x as l,y as n,d as i,w as r,i as d,o as u,e as f,f as _,t as m,v as p,k as h,p as g,q as C,S as y,E as I,l as w}from"./index-DfJFPZaM.js";import{b as k}from"./product.Dc_v3CX8.js";import{a as b,g as v}from"./cart.BQjnrQyK.js";import{g as j}from"./user.C6GM3hFr.js";import"./request.D0Ryayp7.js";const U=a({data:()=>({id:null,product:null,count:1,soldCount:Math.floor(81*Math.random())+20,cartCount:0,userInfo:null}),onLoad(a){a.id&&this.getDetail(a.id)},onShow(){this.checkUserAndLoadCart()},methods:{goBack(){t()},async getDetail(a){try{const t=await k(a);1===t.code&&t.data&&(this.product=t.data)}catch(t){console.error("获取商品详情失败:",t),s({title:"获取商品详情失败",icon:"none"})}},goCart(){e({url:"/pages/cart/cart"})},async checkUserAndLoadCart(){try{const a=await j();1===a.code&&a.data&&(this.userInfo=a.data,o("userInfo",a.data),await this.getCartCount())}catch(a){console.error("获取用户信息失败:",a)}},async addToCart(){try{if(!this.userInfo){const a=await j();if(1!==a.code||!a.data)return void c({url:"/pages/login/login"});this.userInfo=a.data,o("userInfo",a.data)}l({title:"添加中"});const a={userId:this.userInfo.id,productId:this.product.id,quantity:this.count,selected:!0},t=await b(a);if(1!==t.code)throw new Error(t.message||"添加失败");s({title:"添加成功",icon:"success"}),await this.getCartCount()}catch(a){console.error("添加购物车失败:",a),s({title:a.message||"添加失败",icon:"none"})}finally{n()}},async getCartCount(){try{if(!this.userInfo)return;const a=await v(this.userInfo.id);1===a.code&&(this.cartCount=a.data.length||0)}catch(a){console.error("获取购物车数量失败:",a)}},async buyNow(){try{if(!this.userInfo){const a=await j();if(1!==a.code||!a.data)return void c({url:"/pages/login/login"});this.userInfo=a.data,o("userInfo",a.data)}const a={products:[{id:this.product.id,quantity:this.count,price:this.product.price,name:this.product.name,image:this.product.image}],totalAmount:this.product.price*this.count};c({url:`/pages/order/create?orderInfo=${encodeURIComponent(JSON.stringify(a))}`})}catch(a){console.error("立即购买失败:",a),s({title:a.message||"立即购买失败",icon:"none"})}}}},[["render",function(a,t,s,e,o,c){const l=h,n=d,k=g,b=C,v=y,j=I,U=w;return u(),i(n,{class:"page-container"},{default:r((()=>[f(n,{class:"mt-header"},{default:r((()=>[f(n,{class:"header-content"},{default:r((()=>[f(l,{class:"iconfont icon-back back-icon",onClick:c.goBack},null,8,["onClick"]),f(l,{class:"title"},{default:r((()=>[_("商品详情")])),_:1})])),_:1})])),_:1}),f(U,{"scroll-y":"",class:"detail-container",style:{paddingTop:"88rpx"}},{default:r((()=>[f(v,{class:"product-swiper animate__animated animate__fadeIn","indicator-dots":!0,autoplay:!0,interval:3e3,duration:500,"indicator-active-color":"#FFC300"},{default:r((()=>[f(b,{class:"animate__animated animate__zoomIn animate__slow"},{default:r((()=>[f(k,{src:o.product.image||"/static/images/default.png",mode:"aspectFill"},null,8,["src"])])),_:1})])),_:1}),f(n,{class:"product-info mt-card animate__animated animate__fadeInUp animate__delay-1"},{default:r((()=>[f(n,{class:"price-row"},{default:r((()=>[f(l,{class:"mt-price"},{default:r((()=>[_(m(o.product.price),1)])),_:1}),f(l,{class:"sold"},{default:r((()=>[_("已售 "+m(o.soldCount),1)])),_:1})])),_:1}),f(n,{class:"name"},{default:r((()=>[_(m(o.product.name),1)])),_:1}),f(n,{class:"desc"},{default:r((()=>[_(m(o.product.description),1)])),_:1})])),_:1}),f(n,{class:"product-params mt-card animate__animated animate__fadeInUp animate__delay-2"},{default:r((()=>[f(n,{class:"section-title"},{default:r((()=>[f(l,null,{default:r((()=>[_("商品参数")])),_:1})])),_:1}),f(n,{class:"param-list"},{default:r((()=>[f(n,{class:"param-item"},{default:r((()=>[f(l,{class:"label"},{default:r((()=>[_("品牌")])),_:1}),f(l,{class:"value"},{default:r((()=>[_(m(o.product.brand||"暂无"),1)])),_:1})])),_:1}),f(n,{class:"param-item"},{default:r((()=>[f(l,{class:"label"},{default:r((()=>[_("规格")])),_:1}),f(l,{class:"value"},{default:r((()=>[_(m(o.product.spec||"暂无"),1)])),_:1})])),_:1}),f(n,{class:"param-item"},{default:r((()=>[f(l,{class:"label"},{default:r((()=>[_("产地")])),_:1}),f(l,{class:"value"},{default:r((()=>[_(m(o.product.origin||"暂无"),1)])),_:1})])),_:1})])),_:1})])),_:1}),f(n,{class:"product-detail mt-card"},{default:r((()=>[f(n,{class:"section-title"},{default:r((()=>[f(l,null,{default:r((()=>[_("商品详情")])),_:1})])),_:1}),f(j,{nodes:o.product.detail||"暂无详细信息"},null,8,["nodes"])])),_:1})])),_:1}),f(n,{class:"action-bar safe-area-bottom"},{default:r((()=>[f(n,{class:"left"},{default:r((()=>[f(n,{class:"action-item",onClick:c.goCart},{default:r((()=>[f(l,{class:"iconfont icon-cart"}),f(l,null,{default:r((()=>[_("购物车")])),_:1}),o.cartCount>0?(u(),i(l,{key:0,class:"mt-badge"},{default:r((()=>[_(m(o.cartCount),1)])),_:1})):p("",!0)])),_:1},8,["onClick"])])),_:1}),f(n,{class:"right"},{default:r((()=>[f(n,{class:"mt-button plain",onClick:c.addToCart},{default:r((()=>[_("加入购物车")])),_:1},8,["onClick"]),f(n,{class:"mt-button",onClick:c.buyNow},{default:r((()=>[_("立即购买")])),_:1},8,["onClick"])])),_:1})])),_:1})])),_:1})}],["__scopeId","data-v-04a396e1"]]);export{U as default};
