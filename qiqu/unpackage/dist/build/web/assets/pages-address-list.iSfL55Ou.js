import{_ as s,x as e,g as a,a as t,y as d,M as i,D as l,n as o,z as r,d as n,w as c,i as f,o as u,e as h,h as _,j as g,F as m,f as p,v as A,k,A as y,t as w,N as C}from"./index-DfJFPZaM.js";import{g as L,d as D}from"./address.C_JEwSJw.js";import"./request.D0Ryayp7.js";const S=s({data:()=>({addressList:[],loading:!1,isSelectMode:!1}),onLoad(s){this.isSelectMode="true"===s.select,this.getAddresses()},onShow(){this.getAddresses()},methods:{async getAddresses(){if(!this.loading){this.loading=!0,e({title:"加载中"});try{const s=a("userInfo");if(!s)return void t({title:"请先登录",icon:"none"});const e=await L(s.id);if(1!==e.code)throw new Error(e.message||"获取地址列表失败");this.addressList=(e.data||[]).sort(((s,e)=>s.isDefault&&!e.isDefault?-1:!s.isDefault&&e.isDefault?1:0))}catch(s){console.error("获取地址列表失败:",s),t({title:s.message||"获取地址列表失败",icon:"none"})}finally{this.loading=!1,d()}}},selectAddress(s){i("addressSelected",s),l()},editAddress(s){o({url:`/pages/address/edit?id=${s.id}`})},addAddress(){o({url:"/pages/address/edit"})},async deleteAddress(s){r({title:"提示",content:"确定要删除该地址吗？",success:async a=>{if(a.confirm){e({title:"删除中"});try{const e=await D(s);if(1!==e.code)throw new Error(e.message||"删除失败");this.addressList=this.addressList.filter((e=>e.id!==s)),t({title:"删除成功",icon:"success"})}catch(i){console.error("删除地址失败:",i),t({title:i.message||"删除失败",icon:"none"})}finally{d()}}}})}}},[["render",function(s,e,a,t,d,i){const l=k,o=f,r=y;return u(),n(o,{class:"container"},{default:c((()=>[h(o,{class:"address-list"},{default:c((()=>[(u(!0),_(m,null,g(d.addressList,(s=>(u(),n(o,{class:"address-item",key:s.id,onClick:e=>d.isSelectMode?i.selectAddress(s):null},{default:c((()=>[h(o,{class:"info"},{default:c((()=>[h(o,{class:"user"},{default:c((()=>[h(l,{class:"name"},{default:c((()=>[p(w(s.recipientName),1)])),_:2},1024),h(l,{class:"phone"},{default:c((()=>[p(w(s.phone),1)])),_:2},1024)])),_:2},1024),h(o,{class:"address"},{default:c((()=>[p(w(s.address),1)])),_:2},1024)])),_:2},1024),h(o,{class:"actions"},{default:c((()=>[h(l,{class:"edit",onClick:C((e=>i.editAddress(s)),["stop"])},{default:c((()=>[p("编辑")])),_:2},1032,["onClick"]),h(l,{class:"delete",onClick:C((e=>i.deleteAddress(s.id)),["stop"])},{default:c((()=>[p("删除")])),_:2},1032,["onClick"])])),_:2},1024)])),_:2},1032,["onClick"])))),128))])),_:1}),0===d.addressList.length?(u(),n(o,{key:0,class:"empty"},{default:c((()=>[h(l,null,{default:c((()=>[p("暂无收货地址")])),_:1})])),_:1})):A("",!0),h(r,{class:"add-btn",onClick:i.addAddress},{default:c((()=>[p("新增地址")])),_:1},8,["onClick"])])),_:1})}],["__scopeId","data-v-2aa57c83"]]);export{S as default};
