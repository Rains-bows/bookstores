import{_ as s,a as t,n as e,D as a,d as o,w as l,i as c,o as i,e as r,f as n,v as d,h,j as u,F as y,k as f,I as k,t as m,p as g}from"./index-DfJFPZaM.js";import{s as w,g as p,a as _,b as H,c as C}from"./search.B9V6XwV1.js";import"./request.D0Ryayp7.js";const R=s({data:()=>({keyword:"",searchHistory:[],hotSearch:[],suggestList:[],searchResults:[],showResults:!1,loading:!1}),computed:{showEmpty(){return this.showResults&&0===this.searchResults.length&&!this.loading}},created(){this.getHistory(),this.getHotSearch()},methods:{handleInput:function(s,t=300){let e=null;return function(...a){e&&clearTimeout(e),e=setTimeout((()=>{s.apply(this,a),e=null}),t)}}((async function(){if(!this.keyword.trim())return this.suggestList=[],void(this.showResults=!1);try{const s=await w(this.keyword.trim(),1,5);s.data&&(this.suggestList=s.data.map((s=>({id:s.id,name:s.name}))))}catch(s){console.error("获取搜索建议失败:",s)}}),300),async handleSearch(){if(this.keyword.trim()){this.loading=!0,this.showResults=!0,this.suggestList=[];try{const s=await w(this.keyword.trim(),1,10);s.data&&(this.searchResults=s.data,this.addToHistory(this.keyword.trim()))}catch(s){console.error("搜索失败:",s),t({title:"搜索失败",icon:"none"})}finally{this.loading=!1}}},async getHistory(){try{const s=await p();s.data&&(this.searchHistory=s.data)}catch(s){console.error("获取搜索历史失败:",s)}},async getHotSearch(){try{const s=await _();s.data&&(this.hotSearch=s.data)}catch(s){console.error("获取热门搜索失败:",s)}},async addToHistory(s){try{0===(await H(s)).code&&await this.getHistory()}catch(t){console.error("添加搜索历史失败:",t)}},async clearHistory(){try{0===(await C()).code&&(this.searchHistory=[],t({title:"已清空",icon:"success"}))}catch(s){console.error("清空搜索历史失败:",s)}},useHistoryKeyword(s){this.keyword=s,this.handleSearch()},clearKeyword(){this.keyword="",this.suggestList=[],this.showResults=!1},goDetail(s){e({url:`/pages/product/detail?id=${s}`})},goBack(){a()}}},[["render",function(s,t,e,a,w,p){const _=f,H=k,C=c,R=g;return i(),o(C,{class:"container"},{default:l((()=>[r(C,{class:"search-box"},{default:l((()=>[r(C,{class:"input-wrap"},{default:l((()=>[r(_,{class:"iconfont icon-search"}),r(H,{type:"text",modelValue:w.keyword,"onUpdate:modelValue":t[0]||(t[0]=s=>w.keyword=s),placeholder:"请输入商品名称",onInput:p.handleInput,class:"search-input","confirm-type":"search",onConfirm:p.handleSearch},null,8,["modelValue","onInput","onConfirm"]),w.keyword?(i(),o(_,{key:0,class:"clear-icon",onClick:p.clearKeyword},{default:l((()=>[n("×")])),_:1},8,["onClick"])):d("",!0)])),_:1}),r(_,{class:"cancel",onClick:p.goBack},{default:l((()=>[n("取消")])),_:1},8,["onClick"])])),_:1}),!w.keyword&&w.searchHistory.length>0?(i(),o(C,{key:0,class:"history-section"},{default:l((()=>[r(C,{class:"section-header"},{default:l((()=>[r(_,{class:"title"},{default:l((()=>[n("搜索历史")])),_:1}),r(_,{class:"clear",onClick:p.clearHistory},{default:l((()=>[n("清空")])),_:1},8,["onClick"])])),_:1}),r(C,{class:"history-list"},{default:l((()=>[(i(!0),h(y,null,u(w.searchHistory,((s,t)=>(i(),o(C,{class:"history-item",key:t,onClick:t=>p.useHistoryKeyword(s)},{default:l((()=>[r(_,{class:"iconfont icon-time"}),r(_,{class:"keyword"},{default:l((()=>[n(m(s),1)])),_:2},1024)])),_:2},1032,["onClick"])))),128))])),_:1})])),_:1})):d("",!0),!w.keyword&&w.hotSearch.length>0?(i(),o(C,{key:1,class:"hot-section"},{default:l((()=>[r(C,{class:"section-header"},{default:l((()=>[r(_,{class:"title"},{default:l((()=>[n("热门搜索")])),_:1})])),_:1}),r(C,{class:"hot-list"},{default:l((()=>[(i(!0),h(y,null,u(w.hotSearch,((s,t)=>(i(),o(C,{class:"hot-item",key:t,onClick:t=>p.useHistoryKeyword(s)},{default:l((()=>[r(_,{class:"keyword"},{default:l((()=>[n(m(s),1)])),_:2},1024)])),_:2},1032,["onClick"])))),128))])),_:1})])),_:1})):d("",!0),w.keyword&&w.suggestList.length>0?(i(),o(C,{key:2,class:"suggest-section"},{default:l((()=>[(i(!0),h(y,null,u(w.suggestList,((s,t)=>(i(),o(C,{class:"suggest-item",key:t,onClick:t=>p.useHistoryKeyword(s.name)},{default:l((()=>[r(_,{class:"iconfont icon-search"}),r(_,{class:"name"},{default:l((()=>[n(m(s.name),1)])),_:2},1024)])),_:2},1032,["onClick"])))),128))])),_:1})):d("",!0),w.showResults?(i(),o(C,{key:3,class:"result-section"},{default:l((()=>[r(C,{class:"product-list"},{default:l((()=>[(i(!0),h(y,null,u(w.searchResults,(s=>(i(),o(C,{class:"product-item",key:s.id,onClick:t=>p.goDetail(s.id)},{default:l((()=>[r(R,{src:s.image,mode:"aspectFill",class:"product-image"},null,8,["src"]),r(C,{class:"product-info"},{default:l((()=>[r(_,{class:"name"},{default:l((()=>[n(m(s.name),1)])),_:2},1024),r(_,{class:"price"},{default:l((()=>[n("¥"+m(s.price),1)])),_:2},1024)])),_:2},1024)])),_:2},1032,["onClick"])))),128))])),_:1})])),_:1})):d("",!0),p.showEmpty?(i(),o(C,{key:4,class:"empty"},{default:l((()=>[r(_,null,{default:l((()=>[n("暂无相关商品")])),_:1})])),_:1})):d("",!0)])),_:1})}],["__scopeId","data-v-313d5f8d"]]);export{R as default};
