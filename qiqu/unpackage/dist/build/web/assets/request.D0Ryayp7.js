import{g as e,K as r,R as o,u as s,r as a}from"./index-DfJFPZaM.js";const t=["/pages/login/login","/pages/register/register","/pages/reset-password/reset-password"],n=n=>new Promise(((l,i)=>{try{const d=e("token");n.url="http://lapper.site/api"+n.url;const p=r(),u=p[p.length-1],c="/"+(null==u?void 0:u.route);if(!t.includes(c)&&!d)throw new Error("请先登录");if(d&&(n.header={...n.header,Authorization:d}),n.params){const e=Object.keys(n.params).filter((e=>null!=n.params[e])).map((e=>`${encodeURIComponent(e)}=${encodeURIComponent(n.params[e])}`)).join("&");e&&(n.url+=(n.url.includes("?")?"&":"?")+e),delete n.params}console.log("Request:",{url:n.url,method:n.method,headers:n.header,data:n.data}),o({...n,success:e=>{401===e.data.code?(s("token"),s("userInfo"),setTimeout((()=>{a({url:"/pages/login/login"})}),1500),i(new Error("登录已过期,请重新登录"))):l(e.data)},fail:e=>{console.error("Request failed:",e),i(e)}})}catch(d){console.error("Request error:",d),i(d)}}));export{n as r};
