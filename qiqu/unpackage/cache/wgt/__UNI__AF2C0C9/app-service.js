if("undefined"==typeof Promise||Promise.prototype.finally||(Promise.prototype.finally=function(e){const t=this.constructor;return this.then((a=>t.resolve(e()).then((()=>a))),(a=>t.resolve(e()).then((()=>{throw a}))))}),"undefined"!=typeof uni&&uni&&uni.requireGlobal){const e=uni.requireGlobal();ArrayBuffer=e.ArrayBuffer,Int8Array=e.Int8Array,Uint8Array=e.Uint8Array,Uint8ClampedArray=e.Uint8ClampedArray,Int16Array=e.Int16Array,Uint16Array=e.Uint16Array,Int32Array=e.Int32Array,Uint32Array=e.Uint32Array,Float32Array=e.Float32Array,Float64Array=e.Float64Array,BigInt64Array=e.BigInt64Array,BigUint64Array=e.BigUint64Array}uni.restoreGlobal&&uni.restoreGlobal(Vue,weex,plus,setTimeout,clearTimeout,setInterval,clearInterval),function(e,t){"use strict";function a(e,t,...a){uni.__log__?uni.__log__(e,t,...a):console[e].apply(console,[...a,t])}const o=["/pages/login/login","/pages/register/register","/pages/reset-password/reset-password"],n=e=>new Promise(((t,n)=>{try{const s=uni.getStorageSync("token");e.url="https://zaihui.xyz/api"+e.url;const r=getCurrentPages(),i=r[r.length-1],c="/"+(null==i?void 0:i.route);if(!o.includes(c)&&!s)throw new Error("请先登录");if(s&&(e.header={...e.header,Authorization:s}),e.params){const t=Object.keys(e.params).filter((t=>null!=e.params[t])).map((t=>`${encodeURIComponent(t)}=${encodeURIComponent(e.params[t])}`)).join("&");t&&(e.url+=(e.url.includes("?")?"&":"?")+t),delete e.params}a("log","at utils/request.js:56","Request:",{url:e.url,method:e.method,headers:e.header,data:e.data}),uni.request({...e,success:e=>{401===e.data.code?(uni.removeStorageSync("token"),uni.removeStorageSync("userInfo"),setTimeout((()=>{uni.redirectTo({url:"/pages/login/login"})}),1500),n(new Error("登录已过期,请重新登录"))):t(e.data)},fail:e=>{a("error","at utils/request.js:86","Request failed:",e),n(e)}})}catch(s){a("error","at utils/request.js:91","Request error:",s),n(s)}})),s=e=>n({url:`/products/${e}`,method:"GET"}),r=(e,t)=>{const a=e.__vccOpts||e;for(const[o,n]of t)a[o]=n;return a};const i=r({data:()=>({banners:[{image:"/static/images/bg1.jpeg"},{image:"/static/images/bg2.jpeg"},{image:"/static/images/bg3.jpeg"}],categories:[],currentCategory:null,recommendProducts:[],searchKeyword:""}),onLoad(){this.getCategories(),this.getRecommendProducts()},onPullDownRefresh(){this.getRecommendProducts(),setTimeout((()=>{uni.stopPullDownRefresh()}),1e3)},methods:{async getRecommendProducts(){try{if(uni.getStorageSync("token")||(uni.showToast({title:"还没登录"}),uni.redirectTo({url:"/pages/login/login"})),this.searchKeyword){const e=await((e,t=1,a=10)=>n({url:"/products/search",method:"GET",params:{keyword:e.trim(),pageNum:t,pageSize:a}}))(this.searchKeyword);1===e.code&&e.data&&(this.recommendProducts=e.data.map((e=>({...e,soldCount:Math.floor(81*Math.random())+20}))))}else{const e=await((e=1,t=10)=>n({url:"/products/page",method:"GET",params:{pageNum:e,pageSize:t}}))();1===e.code&&e.data&&e.data.length>0&&(this.recommendProducts=this.getRandomItems(e.data,5).map((e=>({...e,soldCount:Math.floor(81*Math.random())+20}))))}a("log","at pages/mall/mall.vue:123","推荐商品:",this.recommendProducts)}catch(e){a("error","at pages/mall/mall.vue:125","获取商品失败:",e),uni.showToast({title:"获取商品失败",icon:"none"})}},getRandomItems:(e,t)=>[...e].sort((()=>.5-Math.random())).slice(0,t),goSearch(){uni.navigateTo({url:"/pages/search/index"})},goDetail(e){uni.navigateTo({url:`/pages/product/detail?id=${e}`})},async getCategories(){try{const e=await n({url:"/categories",method:"GET"});1===e.code&&e.data&&(this.categories=e.data,this.categories.length>0&&(this.currentCategory=this.categories[0].id))}catch(e){a("error","at pages/mall/mall.vue:161","获取分类失败:",e)}},goCategory(e){this.currentCategory=e,uni.setStorageSync("selectedCategoryId",e),uni.switchTab({url:"/pages/category/category",fail:e=>{a("error","at pages/mall/mall.vue:173","跳转失败:",e),uni.showToast({title:"跳转失败",icon:"none"})}})},handleSearch(e){this.searchKeyword=e,this.getRecommendProducts()}}},[["render",function(t,a,o,n,s,r){return e.openBlock(),e.createElementBlock("view",{class:"container"},[e.createElementVNode("view",{class:"header"},[e.createElementVNode("view",{class:"search-bar"},[e.createElementVNode("view",{class:"search-input",onClick:a[0]||(a[0]=(...e)=>r.goSearch&&r.goSearch(...e))},[e.createElementVNode("text",{class:"iconfont icon-search"}),e.createElementVNode("text",{class:"placeholder"},"搜索商品")])])]),e.createElementVNode("swiper",{class:"banner animate__animated animate__fadeIn","indicator-dots":!0,autoplay:!0,interval:3e3,duration:500,"indicator-active-color":"#FFC300"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(s.banners,((t,a)=>(e.openBlock(),e.createElementBlock("swiper-item",{key:a,class:"animate__animated animate__fadeIn"},[e.createElementVNode("image",{src:t.image,mode:"aspectFill"},null,8,["src"])])))),128))]),e.createElementVNode("view",{class:"category-nav"},[e.createElementVNode("scroll-view",{"scroll-x":"",class:"category-scroll"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(s.categories,(t=>(e.openBlock(),e.createElementBlock("view",{class:e.normalizeClass(["category-item",{active:s.currentCategory===t.id}]),key:t.id,onClick:e=>r.goCategory(t.id)},[e.createElementVNode("text",null,e.toDisplayString(t.name),1)],10,["onClick"])))),128))])]),e.createElementVNode("view",{class:"recommend"},[e.createElementVNode("view",{class:"section-title"},[e.createElementVNode("text",{class:"title"},"猜你喜欢"),e.createElementVNode("text",{class:"subtitle"},"为你精选好物")]),e.createElementVNode("view",{class:"product-list"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(s.recommendProducts,(t=>(e.openBlock(),e.createElementBlock("view",{class:"product-item",key:t.id,onClick:e=>r.goDetail(t.id)},[e.createElementVNode("image",{src:t.image||"/static/images/default.png",mode:"aspectFill"},null,8,["src"]),e.createElementVNode("view",{class:"info"},[e.createElementVNode("text",{class:"name"},e.toDisplayString(t.name),1),e.createElementVNode("view",{class:"price-wrap"},[e.createElementVNode("text",{class:"price"},"¥"+e.toDisplayString(t.price),1),e.createElementVNode("text",{class:"sold"},"已售"+e.toDisplayString(t.soldCount||0)+"件",1)])])],8,["onClick"])))),128))])])])}]]),c=e=>n({url:"/user/send-email-code",method:"POST",params:{username:e.username,email:e.email}}),l=()=>n({url:"/user/current",method:"GET"});const d=r({data:()=>({categories:[],currentCategory:{},products:[],loading:!1,scrollTop:0,productScrollTop:0,defaultCategoryId:null,isRefreshing:!1}),onShow(){0===this.categories.length&&this.getCategories();const e=uni.getStorageSync("selectedCategoryId");if(e){const t=this.categories.find((t=>t.id===e));t&&this.switchCategory(t),uni.removeStorageSync("selectedCategoryId")}},onLoad(e){e.id&&(this.defaultCategoryId=Number(e.id)),this.getCategories(e.id)},onTabItemTap(){0===this.categories.length&&this.getCategories()},onHide(){uni.setStorageSync("categoryData",{categories:this.categories,currentCategory:this.currentCategory,products:this.products})},onShow(){const e=uni.getStorageSync("categoryData");if(e){if(this.categories=e.categories,this.currentCategory=e.currentCategory,this.products=e.products,this.defaultCategoryId){const e=this.categories.find((e=>e.id===this.defaultCategoryId));e&&this.switchCategory(e),this.defaultCategoryId=null}}else 0===this.categories.length&&this.getCategories()},onPullDownRefresh(){this.refreshData()},methods:{onScroll(e){this.scrollTop=e.detail.scrollTop},onProductScroll(e){this.productScrollTop=e.detail.scrollTop},async getCategories(e){if(!this.loading){this.loading=!0;try{const t=await n({url:"/categories",method:"GET"});if(1===t.code&&t.data&&t.data.length>0){if(this.categories=t.data.filter((e=>e.isActive)),e)this.currentCategory=this.categories.find((t=>t.id===Number(e)))||this.categories[0];else if(this.currentCategory.id){const e=this.categories.find((e=>e.id===this.currentCategory.id));this.currentCategory=e||this.categories[0]}else this.currentCategory=this.categories[0];this.currentCategory&&(this.products=this.currentCategory.products||[])}else this.categories=[],this.products=[],this.currentCategory={},uni.showToast({title:"暂无分类数据",icon:"none"})}catch(t){a("error","at pages/category/category.vue:183","获取分类失败:",t),uni.showToast({title:"获取分类失败",icon:"none"})}finally{this.loading=!1,this.isRefreshing&&(this.isRefreshing=!1,uni.stopPullDownRefresh())}}},switchCategory(e){e&&e.id&&this.currentCategory.id!==e.id&&(this.currentCategory=e,this.products=e.products||[],this.productScrollTop=0)},async onRefresh(){await this.refreshData()},async refreshData(){this.isRefreshing=!0,this.categories=[],this.products=[],this.currentCategory={},await this.getCategories(),uni.removeStorageSync("categoryData"),uni.stopPullDownRefresh(),this.isRefreshing=!1,uni.showToast({title:"刷新成功",icon:"success",duration:1500})},goDetail(e){uni.navigateTo({url:`/pages/product/detail?id=${e}`,fail:e=>{a("error","at pages/category/category.vue:234","跳转失败:",e),uni.showToast({title:"页面跳转失败",icon:"none"})}})},async handleSendEmailCode(e,t){try{const a=await c({username:e,email:t});1===a.code?uni.showToast({title:a.message||"验证码已发送",icon:"success"}):uni.showToast({title:a.message||"发送失败",icon:"none"})}catch(o){a("error","at pages/category/category.vue:261","发送验证码失败:",o),uni.showToast({title:"发送失败，请重试",icon:"none"})}}}},[["render",function(t,a,o,n,s,r){return e.openBlock(),e.createElementBlock("view",{class:"container"},[e.createElementVNode("view",{class:"nav-bar"},[e.createElementVNode("text",null,"商品分类")]),s.loading?(e.openBlock(),e.createElementBlock("view",{key:0,class:"loading"},[e.createElementVNode("text",null,"加载中...")])):e.createCommentVNode("",!0),e.createElementVNode("view",{class:"content"},[e.createElementVNode("scroll-view",{class:"category-list","scroll-y":"","scroll-top":s.scrollTop,onScroll:a[0]||(a[0]=(...e)=>r.onScroll&&r.onScroll(...e))},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(s.categories,(t=>(e.openBlock(),e.createElementBlock("view",{class:e.normalizeClass(["category-item",{active:s.currentCategory.id===t.id}]),key:t.id,onClick:e=>r.switchCategory(t)},[e.createElementVNode("text",null,e.toDisplayString(t.name),1)],10,["onClick"])))),128))],40,["scroll-top"]),e.createElementVNode("scroll-view",{class:"product-list","scroll-y":"","scroll-top":s.productScrollTop,onScroll:a[1]||(a[1]=(...e)=>r.onProductScroll&&r.onProductScroll(...e)),onScrolltolower:a[2]||(a[2]=(...e)=>t.loadMore&&t.loadMore(...e)),"refresher-enabled":"","refresher-triggered":s.isRefreshing,onRefresherrefresh:a[3]||(a[3]=(...e)=>r.onRefresh&&r.onRefresh(...e))},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(s.products,(t=>(e.openBlock(),e.createElementBlock("view",{class:"product-item",key:t.id,onClick:e=>r.goDetail(t.id)},[e.createElementVNode("image",{src:t.image||"/static/images/default.png",mode:"aspectFill"},null,8,["src"]),e.createElementVNode("view",{class:"info"},[e.createElementVNode("text",{class:"name"},e.toDisplayString(t.name),1),e.createElementVNode("text",{class:"price"},"¥"+e.toDisplayString(t.price),1),e.createElementVNode("text",{class:"desc"},e.toDisplayString(t.description),1)])],8,["onClick"])))),128)),0===s.products.length?(e.openBlock(),e.createElementBlock("view",{key:0,class:"empty"},[e.createElementVNode("text",null,"暂无商品")])):e.createCommentVNode("",!0)],40,["scroll-top","refresher-triggered"])])])}]]),u=e=>n({url:`/cart/user/${e}`,method:"GET"}),m=(e,t)=>n({url:`/cart/${e}`,method:"PUT",data:t});const h=r({data:()=>({cartList:[],loading:!1,userInfo:null}),computed:{isAllSelected(){return this.cartList.length>0&&this.cartList.every((e=>e.selected))},selectedCount(){return this.cartList.filter((e=>e.selected)).length},totalPrice(){return this.cartList.filter((e=>e.selected)).reduce(((e,t)=>{var a;return e+((null==(a=t.productInfo)?void 0:a.price)||0)*t.quantity}),0).toFixed(2)}},onShow(){this.checkUserAndLoadCart()},methods:{async checkUserAndLoadCart(){try{const e=await l();1===e.code&&e.data?(this.userInfo=e.data,uni.setStorageSync("userInfo",e.data),await this.loadCartList()):uni.navigateTo({url:"/pages/login/login"})}catch(e){a("error","at pages/cart/cart.vue:134","获取用户信息失败:",e),uni.showToast({title:"请先登录",icon:"none"}),uni.navigateTo({url:"/pages/login/login"})}},async loadCartList(){if(this.userInfo&&this.userInfo.id)try{uni.showLoading({title:"加载中"});const e=await u(this.userInfo.id);if(1!==e.code)throw new Error(e.message||"获取购物车失败");this.cartList=e.data||[],await this.loadProductDetails()}catch(e){a("error","at pages/cart/cart.vue:168","获取购物车失败:",e),uni.showToast({title:e.message||"获取购物车失败",icon:"none"})}finally{uni.hideLoading()}else a("error","at pages/cart/cart.vue:149","用户未登录")},async loadProductDetails(){const e=this.cartList.map((async e=>{try{const t=await s(e.productId);1===t.code&&(e.productInfo=t.data)}catch(t){a("error","at pages/cart/cart.vue:187",`获取商品${e.productId}详情失败:`,t),e.productInfo=null}}));await Promise.all(e)},async toggleSelect(e){try{const t={...e,selected:!e.selected},a=await m(e.id,t);if(1!==a.code)throw new Error(a.message||"更新失败");{const t=this.cartList.findIndex((t=>t.id===e.id));-1!==t&&(this.cartList[t].selected=!e.selected)}}catch(t){a("error","at pages/cart/cart.vue:213","更新购物车失败:",t),uni.showToast({title:t.message||"更新失败",icon:"none"})}},async toggleSelectAll(){const e=!this.isAllSelected;try{for(const t of this.cartList)t.selected!==e&&(await m(t.id,{...t,selected:e}),t.selected=e)}catch(t){a("error","at pages/cart/cart.vue:232","更新购物车失败:",t),uni.showToast({title:"更新失败",icon:"none"})}},async updateQuantity(e,t){if(!this.userInfo)return;const o=e.quantity+t;if(!(o<1))try{const t={...e,quantity:o,userId:this.userInfo.id},a=await m(e.id,t);if(1!==a.code)throw new Error(a.message||"更新失败");{const t=this.cartList.findIndex((t=>t.id===e.id));-1!==t&&(this.cartList[t].quantity=o)}}catch(n){a("error","at pages/cart/cart.vue:264","更新购物车失败:",n),uni.showToast({title:n.message||"更新失败",icon:"none"})}},async handleQuantityInput(e){const t=parseInt(e.quantity);(isNaN(t)||t<1)&&(e.quantity=1),await this.updateQuantity(e,0)},async deleteItem(e){this.userInfo&&uni.showModal({title:"提示",content:"确定要删除该商品吗？",success:async t=>{if(t.confirm)try{const t=await(o=e.id,n({url:`/cart/${o}`,method:"DELETE"}));if(1!==t.code)throw new Error(t.message||"删除失败");{const t=this.cartList.findIndex((t=>t.id===e.id));-1!==t&&this.cartList.splice(t,1),uni.showToast({title:"删除成功",icon:"success"})}}catch(s){a("error","at pages/cart/cart.vue:305","删除购物车商品失败:",s),uni.showToast({title:s.message||"删除失败",icon:"none"})}var o}})},checkout(){if(0===this.cartList.filter((e=>e.selected)).length)return uni.showToast({title:"请选择商品",icon:"none"});uni.navigateTo({url:"/pages/order/create?from=cart"})},goShopping(){uni.switchTab({url:"/pages/mall/mall"})},goToDetail(e){uni.navigateTo({url:`/pages/product/detail?id=${e}`})}}},[["render",function(t,a,o,n,s,r){return e.openBlock(),e.createElementBlock("view",{class:"container"},[s.cartList.length>0?(e.openBlock(),e.createElementBlock("scroll-view",{key:0,"scroll-y":"",class:"cart-list"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(s.cartList,((t,a)=>{var o,n,s;return e.openBlock(),e.createElementBlock("view",{class:"cart-item",key:t.id},[e.createElementVNode("view",{class:"select-wrap",onClick:e=>r.toggleSelect(t)},[e.createElementVNode("view",{class:e.normalizeClass(["select-icon",{active:t.selected}])},[t.selected?(e.openBlock(),e.createElementBlock("text",{key:0,class:"iconfont icon-check"})):e.createCommentVNode("",!0)],2)],8,["onClick"]),e.createElementVNode("image",{src:(null==(o=t.productInfo)?void 0:o.image)||"/static/images/default.png",mode:"aspectFill",class:"product-image",onClick:e=>r.goToDetail(t.productId)},null,8,["src","onClick"]),e.createElementVNode("view",{class:"product-info"},[e.createElementVNode("text",{class:"name",onClick:e=>r.goToDetail(t.productId)},e.toDisplayString((null==(n=t.productInfo)?void 0:n.name)||"商品已下架"),9,["onClick"]),e.createElementVNode("view",{class:"price-wrap"},[e.createElementVNode("text",{class:"price"},"¥"+e.toDisplayString((null==(s=t.productInfo)?void 0:s.price)||"0.00"),1),e.createElementVNode("view",{class:"quantity-control"},[e.createElementVNode("text",{class:e.normalizeClass(["minus",{disabled:t.quantity<=1}]),onClick:e=>r.updateQuantity(t,-1)},"-",10,["onClick"]),e.withDirectives(e.createElementVNode("input",{type:"number","onUpdate:modelValue":e=>t.quantity=e,onBlur:e=>r.handleQuantityInput(t)},null,40,["onUpdate:modelValue","onBlur"]),[[e.vModelText,t.quantity]]),e.createElementVNode("text",{class:"plus",onClick:e=>r.updateQuantity(t,1)},"+",8,["onClick"])])])]),e.createElementVNode("text",{class:"delete-btn",onClick:e=>r.deleteItem(t)},"×",8,["onClick"])])})),128))])):(e.openBlock(),e.createElementBlock("view",{key:1,class:"empty"},[e.createElementVNode("image",{src:"/static/images/empty-cart.png",mode:"aspectFit",class:"empty-image"}),e.createElementVNode("text",null,"购物车还是空的"),e.createElementVNode("button",{class:"go-shopping",onClick:a[0]||(a[0]=(...e)=>r.goShopping&&r.goShopping(...e))},"去逛逛")])),s.cartList.length>0?(e.openBlock(),e.createElementBlock("view",{key:2,class:"footer"},[e.createElementVNode("view",{class:"select-all",onClick:a[1]||(a[1]=(...e)=>r.toggleSelectAll&&r.toggleSelectAll(...e))},[e.createElementVNode("view",{class:e.normalizeClass(["select-icon",{active:r.isAllSelected}])},[r.isAllSelected?(e.openBlock(),e.createElementBlock("text",{key:0,class:"iconfont icon-check"})):e.createCommentVNode("",!0)],2),e.createElementVNode("text",null,"全选")]),e.createElementVNode("view",{class:"total"},[e.createElementVNode("text",null,"合计："),e.createElementVNode("text",{class:"price"},"¥"+e.toDisplayString(r.totalPrice),1)]),e.createElementVNode("button",{class:"checkout-btn",disabled:0===r.selectedCount,onClick:a[2]||(a[2]=(...e)=>r.checkout&&r.checkout(...e))}," 结算("+e.toDisplayString(r.selectedCount)+") ",9,["disabled"])])):e.createCommentVNode("",!0)])}]]);const g=r({data:()=>({userInfo:{id:"",username:"",nickname:"",avatar:""},orderTypes:[{icon:"/images/home.png",name:"待付款",status:"待付款",count:0},{icon:"icon-box",name:"待发货",status:"待发货",count:0},{icon:"icon-truck",name:"已发货",status:"已发货",count:0},{icon:"icon-comment",name:"已完成",status:"已完成",count:0}]}),onShow(){this.loadUserInfo()},methods:{async loadUserInfo(){try{const e=await l();if(1!==e.code)throw new Error(e.message||"获取用户信息失败");this.userInfo={...this.userInfo,...e.data}}catch(e){a("error","at pages/user/user.vue:130","获取用户信息失败:",e),uni.showToast({title:e.message||"获取用户信息失败",icon:"none"})}},navigateTo(e){uni.navigateTo({url:e})},clearCache(){uni.showModal({title:"提示",content:"确定要清理缓存吗？",success:e=>{if(e.confirm){uni.showLoading({title:"清理中"});try{uni.clearStorageSync(),setTimeout((()=>{uni.hideLoading(),uni.showToast({title:"清理成功",icon:"success"})}),1e3)}catch(t){uni.hideLoading(),uni.showToast({title:"清理失败",icon:"none"})}}}})},handleLogout(){uni.showModal({title:"提示",content:"确定要退出登录吗？",success:e=>{e.confirm&&(uni.removeStorageSync("token"),uni.removeStorageSync("userInfo"),uni.reLaunch({url:"/pages/login/login"}))}})}}},[["render",function(t,a,o,n,s,r){return e.openBlock(),e.createElementBlock("view",{class:"container"},[e.createElementVNode("view",{class:"user-info"},[e.createElementVNode("image",{class:"bg",src:"/static/images/user-bg.jpg",mode:"aspectFill"}),e.createElementVNode("view",{class:"content"},[e.createElementVNode("image",{class:"avatar",src:s.userInfo.avatar||"/static/images/default_male.jpeg",mode:"aspectFill"},null,8,["src"]),e.createElementVNode("view",{class:"info"},[e.createElementVNode("text",{class:"nickname"},e.toDisplayString(s.userInfo.nickname||s.userInfo.username),1),e.createElementVNode("text",{class:"id"},"ID: "+e.toDisplayString(s.userInfo.id),1)])])]),e.createElementVNode("view",{class:"order-card"},[e.createElementVNode("view",{class:"header",onClick:a[0]||(a[0]=e=>r.navigateTo("/pages/order/list?status="))},[e.createElementVNode("text",{class:"title"},"我的订单"),e.createElementVNode("view",{class:"more"},[e.createElementVNode("text",null,"查看全部"),e.createElementVNode("text",{class:"iconfont icon-right"})])]),e.createElementVNode("view",{class:"order-types"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(s.orderTypes,((t,a)=>(e.openBlock(),e.createElementBlock("view",{class:"type-item",key:a,onClick:e=>r.navigateTo(`/pages/order/list?status=${t.status}`)},[e.createElementVNode("view",{class:"icon-wrap"},[e.createElementVNode("text",{class:e.normalizeClass(["iconfont",t.icon])},null,2),t.count>0?(e.openBlock(),e.createElementBlock("text",{key:0,class:"badge"},e.toDisplayString(t.count),1)):e.createCommentVNode("",!0)]),e.createElementVNode("text",{class:"name"},e.toDisplayString(t.name),1)],8,["onClick"])))),128))])]),e.createElementVNode("view",{class:"menu-list"},[e.createElementVNode("view",{class:"menu-group"},[e.createElementVNode("view",{class:"menu-item",onClick:a[1]||(a[1]=e=>r.navigateTo("/pages/address/list"))},[e.createElementVNode("text",{class:"iconfont icon-location"}),e.createElementVNode("text",{class:"title"},"收货地址"),e.createElementVNode("text",{class:"iconfont icon-right"})]),e.createElementVNode("view",{class:"menu-item",onClick:a[2]||(a[2]=e=>r.navigateTo("/pages/about/index"))},[e.createElementVNode("text",{class:"iconfont icon-info"}),e.createElementVNode("text",{class:"title"},"关于我们"),e.createElementVNode("text",{class:"iconfont icon-right"})]),e.createElementVNode("view",{class:"menu-item",onClick:a[3]||(a[3]=(...e)=>r.clearCache&&r.clearCache(...e))},[e.createElementVNode("text",{class:"iconfont icon-clear"}),e.createElementVNode("text",{class:"title"},"清理缓存"),e.createElementVNode("text",{class:"iconfont icon-right"})])])]),e.createElementVNode("view",{class:"logout-btn",onClick:a[4]||(a[4]=(...e)=>r.handleLogout&&r.handleLogout(...e))},"退出登录")])}]]);const p=r({data:()=>({id:null,product:null,count:1,soldCount:Math.floor(81*Math.random())+20,cartCount:0,userInfo:null}),onLoad(e){e.id&&this.getDetail(e.id)},onShow(){this.checkUserAndLoadCart()},methods:{goBack(){uni.navigateBack()},async getDetail(e){try{const t=await s(e);1===t.code&&t.data&&(this.product=t.data)}catch(t){a("error","at pages/product/detail.vue:121","获取商品详情失败:",t),uni.showToast({title:"获取商品详情失败",icon:"none"})}},goCart(){uni.switchTab({url:"/pages/cart/cart"})},async checkUserAndLoadCart(){try{const e=await l();1===e.code&&e.data&&(this.userInfo=e.data,uni.setStorageSync("userInfo",e.data),await this.getCartCount())}catch(e){a("error","at pages/product/detail.vue:148","获取用户信息失败:",e)}},async addToCart(){try{if(!this.userInfo){const e=await l();if(1!==e.code||!e.data)return void uni.navigateTo({url:"/pages/login/login"});this.userInfo=e.data,uni.setStorageSync("userInfo",e.data)}uni.showLoading({title:"添加中"});const t={userId:this.userInfo.id,productId:this.product.id,quantity:this.count,selected:!0},a=await(e=t,n({url:"/cart",method:"POST",data:e}));if(1!==a.code)throw new Error(a.message||"添加失败");uni.showToast({title:"添加成功",icon:"success"}),await this.getCartCount()}catch(t){a("error","at pages/product/detail.vue:192","添加购物车失败:",t),uni.showToast({title:t.message||"添加失败",icon:"none"})}finally{uni.hideLoading()}var e},async getCartCount(){try{if(!this.userInfo)return;const e=await u(this.userInfo.id);1===e.code&&(this.cartCount=e.data.length||0)}catch(e){a("error","at pages/product/detail.vue:211","获取购物车数量失败:",e)}},async buyNow(){try{if(!this.userInfo){const e=await l();if(1!==e.code||!e.data)return void uni.navigateTo({url:"/pages/login/login"});this.userInfo=e.data,uni.setStorageSync("userInfo",e.data)}const e={products:[{id:this.product.id,quantity:this.count,price:this.product.price,name:this.product.name,image:this.product.image}],totalAmount:this.product.price*this.count};uni.navigateTo({url:`/pages/order/create?orderInfo=${encodeURIComponent(JSON.stringify(e))}`})}catch(e){a("error","at pages/product/detail.vue:248","立即购买失败:",e),uni.showToast({title:e.message||"立即购买失败",icon:"none"})}}}},[["render",function(t,a,o,n,s,r){return e.openBlock(),e.createElementBlock("view",{class:"page-container"},[e.createElementVNode("view",{class:"mt-header"},[e.createElementVNode("view",{class:"header-content"},[e.createElementVNode("text",{class:"iconfont icon-back back-icon",onClick:a[0]||(a[0]=(...e)=>r.goBack&&r.goBack(...e))}),e.createElementVNode("text",{class:"title"},"商品详情")])]),e.createElementVNode("scroll-view",{"scroll-y":"",class:"detail-container",style:{paddingTop:"88rpx"}},[e.createElementVNode("swiper",{class:"product-swiper animate__animated animate__fadeIn","indicator-dots":!0,autoplay:!0,interval:3e3,duration:500,"indicator-active-color":"#FFC300"},[e.createElementVNode("swiper-item",{class:"animate__animated animate__zoomIn animate__slow"},[e.createElementVNode("image",{src:s.product.image||"/static/images/default.png",mode:"aspectFill"},null,8,["src"])])]),e.createElementVNode("view",{class:"product-info mt-card animate__animated animate__fadeInUp animate__delay-1"},[e.createElementVNode("view",{class:"price-row"},[e.createElementVNode("text",{class:"mt-price"},e.toDisplayString(s.product.price),1),e.createElementVNode("text",{class:"sold"},"已售 "+e.toDisplayString(s.soldCount),1)]),e.createElementVNode("view",{class:"name"},e.toDisplayString(s.product.name),1),e.createElementVNode("view",{class:"desc"},e.toDisplayString(s.product.description),1)]),e.createElementVNode("view",{class:"product-params mt-card animate__animated animate__fadeInUp animate__delay-2"},[e.createElementVNode("view",{class:"section-title"},[e.createElementVNode("text",null,"商品参数")]),e.createElementVNode("view",{class:"param-list"},[e.createElementVNode("view",{class:"param-item"},[e.createElementVNode("text",{class:"label"},"品牌"),e.createElementVNode("text",{class:"value"},e.toDisplayString(s.product.brand||"暂无"),1)]),e.createElementVNode("view",{class:"param-item"},[e.createElementVNode("text",{class:"label"},"规格"),e.createElementVNode("text",{class:"value"},e.toDisplayString(s.product.spec||"暂无"),1)]),e.createElementVNode("view",{class:"param-item"},[e.createElementVNode("text",{class:"label"},"产地"),e.createElementVNode("text",{class:"value"},e.toDisplayString(s.product.origin||"暂无"),1)])])]),e.createElementVNode("view",{class:"product-detail mt-card"},[e.createElementVNode("view",{class:"section-title"},[e.createElementVNode("text",null,"商品详情")]),e.createElementVNode("rich-text",{nodes:s.product.detail||"暂无详细信息"},null,8,["nodes"])])]),e.createElementVNode("view",{class:"action-bar safe-area-bottom"},[e.createElementVNode("view",{class:"left"},[e.createElementVNode("view",{class:"action-item",onClick:a[1]||(a[1]=(...e)=>r.goCart&&r.goCart(...e))},[e.createElementVNode("text",{class:"iconfont icon-cart"}),e.createElementVNode("text",null,"购物车"),s.cartCount>0?(e.openBlock(),e.createElementBlock("text",{key:0,class:"mt-badge"},e.toDisplayString(s.cartCount),1)):e.createCommentVNode("",!0)])]),e.createElementVNode("view",{class:"right"},[e.createElementVNode("view",{class:"mt-button plain",onClick:a[2]||(a[2]=(...e)=>r.addToCart&&r.addToCart(...e))},"加入购物车"),e.createElementVNode("view",{class:"mt-button",onClick:a[3]||(a[3]=(...e)=>r.buyNow&&r.buyNow(...e))},"立即购买")])])])}]]);const w=async e=>{try{const t=await n({url:`/userAddress/findByUserId/${e}`,method:"GET"});return{code:t.code||1,message:t.message||"success",data:t.data||[]}}catch(t){return{code:0,message:t.message||"获取地址列表失败",data:null}}},f=async e=>{try{const t=await n({url:"/userAddress/insert",method:"POST",data:e});return{code:t.code||1,message:t.message||"success",data:t.data||null}}catch(t){return{code:0,message:t.message||"新增地址失败",data:null}}},y=async e=>{try{const t=await n({url:"/userAddress/update",method:"PUT",data:e});return{code:t.code||1,message:t.message||"success",data:t.data||null}}catch(t){return{code:0,message:t.message||"更新地址失败",data:null}}};const E=r({data:()=>({orderInfo:{products:[],totalAmount:0},paymentOptions:[{label:"支付宝",value:"alipay",icon:"icon-alipay"},{label:"微信支付",value:"wechat",icon:"icon-wechat"}],selectedPayment:"alipay",userInfo:null,deliveryType:"express",selectedAddress:null}),computed:{totalAmount(){return Number(this.orderInfo.totalAmount).toFixed(2)}},onLoad(e){if(e.orderInfo)try{this.orderInfo=JSON.parse(decodeURIComponent(e.orderInfo)),a("log","at pages/order/create.vue:141","接收到的订单信息:",this.orderInfo)}catch(t){a("error","at pages/order/create.vue:143","解析订单信息失败:",t),uni.showToast({title:"订单信息错误",icon:"none"}),setTimeout((()=>{uni.navigateBack()}),1500)}this.initData(),uni.$on("addressSelected",this.handleAddressSelected)},onUnload(){uni.$off("addressSelected",this.handleAddressSelected)},methods:{generateOrderId:()=>`${(new Date).getTime()}${Math.floor(1e3*Math.random()).toString().padStart(3,"0")}`,async initData(){try{const e=await l();1===e.code&&e.data?(this.userInfo=e.data,"express"===this.deliveryType&&await this.loadAddressList()):uni.navigateTo({url:"/pages/login/login"})}catch(e){a("error","at pages/order/create.vue:191","初始化数据失败:",e)}},async loadAddressList(){var e;try{const t=await w(this.userInfo.id);1===t.code&&(null==(e=t.data)?void 0:e.length)>0&&(this.selectedAddress=t.data[0])}catch(t){a("error","at pages/order/create.vue:203","加载地址列表失败:",t)}},handleAddressClick(){"express"===this.deliveryType&&uni.navigateTo({url:"/pages/address/list?select=true"})},handleAddressSelected(e){if(e){this.selectedAddress=e;const t=document.querySelector(".address-card");t&&(t.classList.add("address-selected"),setTimeout((()=>{t.classList.remove("address-selected")}),500))}},async changeDeliveryType(e){this.deliveryType=e,"express"!==e||this.selectedAddress||await this.loadAddressList()},handleImageError(e){const t=e.target;t&&(t.src="/static/images/default-product.png")},selectPayment(e){this.selectedPayment=e},async beforeSubmitOrder(){return"self"===this.deliveryType||(!("express"===this.deliveryType&&!this.selectedAddress)||(uni.showToast({title:"请选择收货地址",icon:"none"}),!1))},async submitOrder(){if(!(await this.beforeSubmitOrder()))return;const e=document.querySelector(".submit-btn");e&&(e.classList.add("submit-btn-active"),setTimeout((()=>{e.classList.remove("submit-btn-active")}),200));try{uni.showLoading({title:"提交中"});const e=this.generateOrderId(),s=new Date,r={id:e,userId:this.userInfo.id,totalAmount:Number(this.totalAmount),status:"待付款",deliveryType:this.deliveryType,paymentMethod:this.selectedPayment,createdAt:s,updatedAt:s,addressId:"self"===this.deliveryType?0:this.selectedAddress.id},i=await(o=r,n({url:"/order/create",method:"POST",data:o}));if(1!==i.code){if(i.message&&i.message.includes("重复"))return a("log","at pages/order/create.vue:333","订单号重复，重新尝试"),void(await this.submitOrder());throw new Error(i.message||"创建订单失败")}for(const a of this.orderInfo.products){const o={orderId:e,productId:a.id,quantity:a.quantity,price:a.price,userAddressId:"self"===this.deliveryType?0:this.selectedAddress.id};if(1!==(await(t=o,n({url:"/orderDetails",method:"POST",data:t}))).code)throw new Error("创建订单详情失败")}uni.redirectTo({url:`/pages/payment/index?orderNo=${e}&amount=${this.totalAmount}&name=${encodeURIComponent(this.orderInfo.products[0].name)}&payType=${"wechat"===this.selectedPayment?"wxpay":"alipay"}`})}catch(s){a("error","at pages/order/create.vue:340","提交订单失败:",s),uni.showToast({title:s.message||"提交订单失败",icon:"none"})}finally{uni.hideLoading()}var t,o}}},[["render",function(t,a,o,n,s,r){return e.openBlock(),e.createElementBlock("view",{class:"container"},[e.createElementVNode("view",{class:"delivery-section"},[e.createElementVNode("text",{class:"section-title"},"配送方式"),e.createElementVNode("view",{class:"delivery-options"},[e.createElementVNode("view",{class:e.normalizeClass(["delivery-item",{active:"express"===s.deliveryType}]),onClick:a[0]||(a[0]=e=>r.changeDeliveryType("express"))},[e.createElementVNode("text",{class:"iconfont icon-express"}),e.createElementVNode("text",null,"快递配送")],2),e.createElementVNode("view",{class:e.normalizeClass(["delivery-item",{active:"self"===s.deliveryType}]),onClick:a[1]||(a[1]=e=>r.changeDeliveryType("self"))},[e.createElementVNode("text",{class:"iconfont icon-pickup"}),e.createElementVNode("text",null,"自提柜自提")],2)])]),"express"===s.deliveryType?(e.openBlock(),e.createElementBlock("view",{key:0,class:"address-card",onClick:a[2]||(a[2]=(...e)=>r.handleAddressClick&&r.handleAddressClick(...e))},[s.selectedAddress?(e.openBlock(),e.createElementBlock("view",{key:0,class:"address-info"},[e.createElementVNode("view",{class:"user-info"},[e.createElementVNode("text",{class:"name"},e.toDisplayString(s.selectedAddress.recipientName),1),e.createElementVNode("text",{class:"phone"},e.toDisplayString(s.selectedAddress.phone),1)]),e.createElementVNode("view",{class:"address"},e.toDisplayString(s.selectedAddress.address),1)])):(e.openBlock(),e.createElementBlock("view",{key:1,class:"no-address"},[e.createElementVNode("text",null,"请选择收货地址")])),e.createElementVNode("text",{class:"iconfont icon-right"})])):(e.openBlock(),e.createElementBlock("view",{key:1,class:"address-card"},[e.createElementVNode("view",{class:"address-info"},[e.createElementVNode("view",{class:"user-info"},[e.createElementVNode("text",{class:"name"},"自提柜自提")]),e.createElementVNode("view",{class:"address"},"商品将配送至就近的自提柜，请注意查收提货码")])])),e.createElementVNode("view",{class:"goods-card"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(s.orderInfo.products,(t=>(e.openBlock(),e.createElementBlock("view",{class:"goods-item",key:t.id},[e.createElementVNode("image",{src:t.image,mode:"aspectFill",class:"goods-image",onError:a[3]||(a[3]=(...e)=>r.handleImageError&&r.handleImageError(...e))},null,40,["src"]),e.createElementVNode("view",{class:"goods-info"},[e.createElementVNode("text",{class:"goods-name"},e.toDisplayString(t.name),1),e.createElementVNode("view",{class:"goods-price-wrap"},[e.createElementVNode("text",{class:"goods-price"},"¥"+e.toDisplayString(t.price),1),e.createElementVNode("text",{class:"goods-count"},"x"+e.toDisplayString(t.quantity),1)])])])))),128))]),e.createElementVNode("view",{class:"payment-card"},[e.createElementVNode("view",{class:"card-title"},"支付方式"),e.createElementVNode("view",{class:"payment-options"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(s.paymentOptions,((t,a)=>(e.openBlock(),e.createElementBlock("view",{class:e.normalizeClass(["payment-item",{active:s.selectedPayment===t.value}]),key:a,onClick:e=>r.selectPayment(t.value)},[e.createElementVNode("text",{class:e.normalizeClass(["iconfont",t.icon])},null,2),e.createElementVNode("text",null,e.toDisplayString(t.label),1)],10,["onClick"])))),128))])]),e.createElementVNode("view",{class:"amount-card"},[e.createElementVNode("view",{class:"amount-item"},[e.createElementVNode("text",null,"商品金额"),e.createElementVNode("text",null,"¥"+e.toDisplayString(s.orderInfo.totalAmount),1)]),e.createElementVNode("view",{class:"amount-item total"},[e.createElementVNode("text",null,"实付款"),e.createElementVNode("text",{class:"price"},"¥"+e.toDisplayString(r.totalAmount),1)])]),e.createElementVNode("view",{class:"bottom-bar"},[e.createElementVNode("view",{class:"total-wrap"},[e.createElementVNode("text",null,"合计："),e.createElementVNode("text",{class:"price"},"¥"+e.toDisplayString(r.totalAmount),1)]),e.createElementVNode("button",{class:"submit-btn",onClick:a[4]||(a[4]=(...e)=>r.submitOrder&&r.submitOrder(...e))},"提交订单")])])}]]);var v={},N={};let V;const k=[0,26,44,70,100,134,172,196,242,292,346,404,466,532,581,655,733,815,901,991,1085,1156,1258,1364,1474,1588,1706,1828,1921,2051,2185,2323,2465,2611,2761,2876,3034,3196,3362,3532,3706];N.getSymbolSize=function(e){if(!e)throw new Error('"version" cannot be null or undefined');if(e<1||e>40)throw new Error('"version" should be in range from 1 to 40');return 4*e+17},N.getSymbolTotalCodewords=function(e){return k[e]},N.getBCHDigit=function(e){let t=0;for(;0!==e;)t++,e>>>=1;return t},N.setToSJISFunction=function(e){if("function"!=typeof e)throw new Error('"toSJISFunc" is not a valid function.');V=e},N.isKanjiModeEnabled=function(){return void 0!==V},N.toSJIS=function(e){return V(e)};var S,C={};function x(){this.buffer=[],this.length=0}(S=C).L={bit:1},S.M={bit:0},S.Q={bit:3},S.H={bit:2},S.isValid=function(e){return e&&void 0!==e.bit&&e.bit>=0&&e.bit<4},S.from=function(e,t){if(S.isValid(e))return e;try{return function(e){if("string"!=typeof e)throw new Error("Param is not a string");switch(e.toLowerCase()){case"l":case"low":return S.L;case"m":case"medium":return S.M;case"q":case"quartile":return S.Q;case"h":case"high":return S.H;default:throw new Error("Unknown EC Level: "+e)}}(e)}catch(a){return t}},x.prototype={get:function(e){const t=Math.floor(e/8);return 1==(this.buffer[t]>>>7-e%8&1)},put:function(e,t){for(let a=0;a<t;a++)this.putBit(1==(e>>>t-a-1&1))},getLengthInBits:function(){return this.length},putBit:function(e){const t=Math.floor(this.length/8);this.buffer.length<=t&&this.buffer.push(0),e&&(this.buffer[t]|=128>>>this.length%8),this.length++}};var T=x;function B(e){if(!e||e<1)throw new Error("BitMatrix size must be defined and greater than 0");this.size=e,this.data=new Uint8Array(e*e),this.reservedBit=new Uint8Array(e*e)}B.prototype.set=function(e,t,a,o){const n=e*this.size+t;this.data[n]=a,o&&(this.reservedBit[n]=!0)},B.prototype.get=function(e,t){return this.data[e*this.size+t]},B.prototype.xor=function(e,t,a){this.data[e*this.size+t]^=a},B.prototype.isReserved=function(e,t){return this.reservedBit[e*this.size+t]};var b=B,I={};!function(e){const t=N.getSymbolSize;e.getRowColCoords=function(e){if(1===e)return[];const a=Math.floor(e/7)+2,o=t(e),n=145===o?26:2*Math.ceil((o-13)/(2*a-2)),s=[o-7];for(let t=1;t<a-1;t++)s[t]=s[t-1]-n;return s.push(6),s.reverse()},e.getPositions=function(t){const a=[],o=e.getRowColCoords(t),n=o.length;for(let e=0;e<n;e++)for(let t=0;t<n;t++)0===e&&0===t||0===e&&t===n-1||e===n-1&&0===t||a.push([o[e],o[t]]);return a}}(I);var A={};const P=N.getSymbolSize;A.getPositions=function(e){const t=P(e);return[[0,0],[t-7,0],[0,t-7]]};var L={};!function(e){e.Patterns={PATTERN000:0,PATTERN001:1,PATTERN010:2,PATTERN011:3,PATTERN100:4,PATTERN101:5,PATTERN110:6,PATTERN111:7};const t=3,a=3,o=40,n=10;function s(t,a,o){switch(t){case e.Patterns.PATTERN000:return(a+o)%2==0;case e.Patterns.PATTERN001:return a%2==0;case e.Patterns.PATTERN010:return o%3==0;case e.Patterns.PATTERN011:return(a+o)%3==0;case e.Patterns.PATTERN100:return(Math.floor(a/2)+Math.floor(o/3))%2==0;case e.Patterns.PATTERN101:return a*o%2+a*o%3==0;case e.Patterns.PATTERN110:return(a*o%2+a*o%3)%2==0;case e.Patterns.PATTERN111:return(a*o%3+(a+o)%2)%2==0;default:throw new Error("bad maskPattern:"+t)}}e.isValid=function(e){return null!=e&&""!==e&&!isNaN(e)&&e>=0&&e<=7},e.from=function(t){return e.isValid(t)?parseInt(t,10):void 0},e.getPenaltyN1=function(e){const a=e.size;let o=0,n=0,s=0,r=null,i=null;for(let c=0;c<a;c++){n=s=0,r=i=null;for(let l=0;l<a;l++){let a=e.get(c,l);a===r?n++:(n>=5&&(o+=t+(n-5)),r=a,n=1),a=e.get(l,c),a===i?s++:(s>=5&&(o+=t+(s-5)),i=a,s=1)}n>=5&&(o+=t+(n-5)),s>=5&&(o+=t+(s-5))}return o},e.getPenaltyN2=function(e){const t=e.size;let o=0;for(let a=0;a<t-1;a++)for(let n=0;n<t-1;n++){const t=e.get(a,n)+e.get(a,n+1)+e.get(a+1,n)+e.get(a+1,n+1);4!==t&&0!==t||o++}return o*a},e.getPenaltyN3=function(e){const t=e.size;let a=0,n=0,s=0;for(let o=0;o<t;o++){n=s=0;for(let r=0;r<t;r++)n=n<<1&2047|e.get(o,r),r>=10&&(1488===n||93===n)&&a++,s=s<<1&2047|e.get(r,o),r>=10&&(1488===s||93===s)&&a++}return a*o},e.getPenaltyN4=function(e){let t=0;const a=e.data.length;for(let o=0;o<a;o++)t+=e.data[o];return Math.abs(Math.ceil(100*t/a/5)-10)*n},e.applyMask=function(e,t){const a=t.size;for(let o=0;o<a;o++)for(let n=0;n<a;n++)t.isReserved(n,o)||t.xor(n,o,s(e,n,o))},e.getBestMask=function(t,a){const o=Object.keys(e.Patterns).length;let n=0,s=1/0;for(let r=0;r<o;r++){a(r),e.applyMask(r,t);const o=e.getPenaltyN1(t)+e.getPenaltyN2(t)+e.getPenaltyN3(t)+e.getPenaltyN4(t);e.applyMask(r,t),o<s&&(s=o,n=r)}return n}}(L);var D={};const M=C,_=[1,1,1,1,1,1,1,1,1,1,2,2,1,2,2,4,1,2,4,4,2,4,4,4,2,4,6,5,2,4,6,6,2,5,8,8,4,5,8,8,4,5,8,11,4,8,10,11,4,9,12,16,4,9,16,16,6,10,12,18,6,10,17,16,6,11,16,19,6,13,18,21,7,14,21,25,8,16,20,25,8,17,23,25,9,17,23,34,9,18,25,30,10,20,27,32,12,21,29,35,12,23,34,37,12,25,34,40,13,26,35,42,14,28,38,45,15,29,40,48,16,31,43,51,17,33,45,54,18,35,48,57,19,37,51,60,19,38,53,63,20,40,56,66,21,43,59,70,22,45,62,74,24,47,65,77,25,49,68,81],U=[7,10,13,17,10,16,22,28,15,26,36,44,20,36,52,64,26,48,72,88,36,64,96,112,40,72,108,130,48,88,132,156,60,110,160,192,72,130,192,224,80,150,224,264,96,176,260,308,104,198,288,352,120,216,320,384,132,240,360,432,144,280,408,480,168,308,448,532,180,338,504,588,196,364,546,650,224,416,600,700,224,442,644,750,252,476,690,816,270,504,750,900,300,560,810,960,312,588,870,1050,336,644,952,1110,360,700,1020,1200,390,728,1050,1260,420,784,1140,1350,450,812,1200,1440,480,868,1290,1530,510,924,1350,1620,540,980,1440,1710,570,1036,1530,1800,570,1064,1590,1890,600,1120,1680,1980,630,1204,1770,2100,660,1260,1860,2220,720,1316,1950,2310,750,1372,2040,2430];D.getBlocksCount=function(e,t){switch(t){case M.L:return _[4*(e-1)+0];case M.M:return _[4*(e-1)+1];case M.Q:return _[4*(e-1)+2];case M.H:return _[4*(e-1)+3];default:return}},D.getTotalCodewordsCount=function(e,t){switch(t){case M.L:return U[4*(e-1)+0];case M.M:return U[4*(e-1)+1];case M.Q:return U[4*(e-1)+2];case M.H:return U[4*(e-1)+3];default:return}};var R={},F={};const O=new Uint8Array(512),z=new Uint8Array(256);!function(){let e=1;for(let t=0;t<255;t++)O[t]=e,z[e]=t,e<<=1,256&e&&(e^=285);for(let t=255;t<512;t++)O[t]=O[t-255]}(),F.log=function(e){if(e<1)throw new Error("log("+e+")");return z[e]},F.exp=function(e){return O[e]},F.mul=function(e,t){return 0===e||0===t?0:O[z[e]+z[t]]},function(e){const t=F;e.mul=function(e,a){const o=new Uint8Array(e.length+a.length-1);for(let n=0;n<e.length;n++)for(let s=0;s<a.length;s++)o[n+s]^=t.mul(e[n],a[s]);return o},e.mod=function(e,a){let o=new Uint8Array(e);for(;o.length-a.length>=0;){const e=o[0];for(let s=0;s<a.length;s++)o[s]^=t.mul(a[s],e);let n=0;for(;n<o.length&&0===o[n];)n++;o=o.slice(n)}return o},e.generateECPolynomial=function(a){let o=new Uint8Array([1]);for(let n=0;n<a;n++)o=e.mul(o,new Uint8Array([1,t.exp(n)]));return o}}(R);const q=R;function H(e){this.genPoly=void 0,this.degree=e,this.degree&&this.initialize(this.degree)}H.prototype.initialize=function(e){this.degree=e,this.genPoly=q.generateECPolynomial(this.degree)},H.prototype.encode=function(e){if(!this.genPoly)throw new Error("Encoder not initialized");const t=new Uint8Array(e.length+this.degree);t.set(e);const a=q.mod(t,this.genPoly),o=this.degree-a.length;if(o>0){const e=new Uint8Array(this.degree);return e.set(a,o),e}return a};var $=H,K={},j={},Q={isValid:function(e){return!isNaN(e)&&e>=1&&e<=40}},J={};const Y="[0-9]+";let G="(?:[u3000-u303F]|[u3040-u309F]|[u30A0-u30FF]|[uFF00-uFFEF]|[u4E00-u9FAF]|[u2605-u2606]|[u2190-u2195]|u203B|[u2010u2015u2018u2019u2025u2026u201Cu201Du2225u2260]|[u0391-u0451]|[u00A7u00A8u00B1u00B4u00D7u00F7])+";G=G.replace(/u/g,"\\u");const W="(?:(?![A-Z0-9 $%*+\\-./:]|"+G+")(?:.|[\r\n]))+";J.KANJI=new RegExp(G,"g"),J.BYTE_KANJI=new RegExp("[^A-Z0-9 $%*+\\-./:]+","g"),J.BYTE=new RegExp(W,"g"),J.NUMERIC=new RegExp(Y,"g"),J.ALPHANUMERIC=new RegExp("[A-Z $%*+\\-./:]+","g");const Z=new RegExp("^"+G+"$"),X=new RegExp("^[0-9]+$"),ee=new RegExp("^[A-Z0-9 $%*+\\-./:]+$");J.testKanji=function(e){return Z.test(e)},J.testNumeric=function(e){return X.test(e)},J.testAlphanumeric=function(e){return ee.test(e)},function(e){const t=Q,a=J;e.NUMERIC={id:"Numeric",bit:1,ccBits:[10,12,14]},e.ALPHANUMERIC={id:"Alphanumeric",bit:2,ccBits:[9,11,13]},e.BYTE={id:"Byte",bit:4,ccBits:[8,16,16]},e.KANJI={id:"Kanji",bit:8,ccBits:[8,10,12]},e.MIXED={bit:-1},e.getCharCountIndicator=function(e,a){if(!e.ccBits)throw new Error("Invalid mode: "+e);if(!t.isValid(a))throw new Error("Invalid version: "+a);return a>=1&&a<10?e.ccBits[0]:a<27?e.ccBits[1]:e.ccBits[2]},e.getBestModeForData=function(t){return a.testNumeric(t)?e.NUMERIC:a.testAlphanumeric(t)?e.ALPHANUMERIC:a.testKanji(t)?e.KANJI:e.BYTE},e.toString=function(e){if(e&&e.id)return e.id;throw new Error("Invalid mode")},e.isValid=function(e){return e&&e.bit&&e.ccBits},e.from=function(t,a){if(e.isValid(t))return t;try{return function(t){if("string"!=typeof t)throw new Error("Param is not a string");switch(t.toLowerCase()){case"numeric":return e.NUMERIC;case"alphanumeric":return e.ALPHANUMERIC;case"kanji":return e.KANJI;case"byte":return e.BYTE;default:throw new Error("Unknown mode: "+t)}}(t)}catch(o){return a}}}(j),function(e){const t=N,a=D,o=C,n=j,s=Q,r=t.getBCHDigit(7973);function i(e,t){return n.getCharCountIndicator(e,t)+4}function c(e,t){let a=0;return e.forEach((function(e){const o=i(e.mode,t);a+=o+e.getBitsLength()})),a}e.from=function(e,t){return s.isValid(e)?parseInt(e,10):t},e.getCapacity=function(e,o,r){if(!s.isValid(e))throw new Error("Invalid QR Code version");void 0===r&&(r=n.BYTE);const c=8*(t.getSymbolTotalCodewords(e)-a.getTotalCodewordsCount(e,o));if(r===n.MIXED)return c;const l=c-i(r,e);switch(r){case n.NUMERIC:return Math.floor(l/10*3);case n.ALPHANUMERIC:return Math.floor(l/11*2);case n.KANJI:return Math.floor(l/13);case n.BYTE:default:return Math.floor(l/8)}},e.getBestVersionForData=function(t,a){let s;const r=o.from(a,o.M);if(Array.isArray(t)){if(t.length>1)return function(t,a){for(let o=1;o<=40;o++)if(c(t,o)<=e.getCapacity(o,a,n.MIXED))return o}(t,r);if(0===t.length)return 1;s=t[0]}else s=t;return function(t,a,o){for(let n=1;n<=40;n++)if(a<=e.getCapacity(n,o,t))return n}(s.mode,s.getLength(),r)},e.getEncodedBits=function(e){if(!s.isValid(e)||e<7)throw new Error("Invalid QR Code version");let a=e<<12;for(;t.getBCHDigit(a)-r>=0;)a^=7973<<t.getBCHDigit(a)-r;return e<<12|a}}(K);var te={};const ae=N,oe=ae.getBCHDigit(1335);te.getEncodedBits=function(e,t){const a=e.bit<<3|t;let o=a<<10;for(;ae.getBCHDigit(o)-oe>=0;)o^=1335<<ae.getBCHDigit(o)-oe;return 21522^(a<<10|o)};var ne={};const se=j;function re(e){this.mode=se.NUMERIC,this.data=e.toString()}re.getBitsLength=function(e){return 10*Math.floor(e/3)+(e%3?e%3*3+1:0)},re.prototype.getLength=function(){return this.data.length},re.prototype.getBitsLength=function(){return re.getBitsLength(this.data.length)},re.prototype.write=function(e){let t,a,o;for(t=0;t+3<=this.data.length;t+=3)a=this.data.substr(t,3),o=parseInt(a,10),e.put(o,10);const n=this.data.length-t;n>0&&(a=this.data.substr(t),o=parseInt(a,10),e.put(o,3*n+1))};var ie=re;const ce=j,le=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"," ","$","%","*","+","-",".","/",":"];function de(e){this.mode=ce.ALPHANUMERIC,this.data=e}de.getBitsLength=function(e){return 11*Math.floor(e/2)+e%2*6},de.prototype.getLength=function(){return this.data.length},de.prototype.getBitsLength=function(){return de.getBitsLength(this.data.length)},de.prototype.write=function(e){let t;for(t=0;t+2<=this.data.length;t+=2){let a=45*le.indexOf(this.data[t]);a+=le.indexOf(this.data[t+1]),e.put(a,11)}this.data.length%2&&e.put(le.indexOf(this.data[t]),6)};var ue=de;const me=j;function he(e){this.mode=me.BYTE,this.data="string"==typeof e?(new TextEncoder).encode(e):new Uint8Array(e)}he.getBitsLength=function(e){return 8*e},he.prototype.getLength=function(){return this.data.length},he.prototype.getBitsLength=function(){return he.getBitsLength(this.data.length)},he.prototype.write=function(e){for(let t=0,a=this.data.length;t<a;t++)e.put(this.data[t],8)};var ge=he;const pe=j,we=N;function fe(e){this.mode=pe.KANJI,this.data=e}fe.getBitsLength=function(e){return 13*e},fe.prototype.getLength=function(){return this.data.length},fe.prototype.getBitsLength=function(){return fe.getBitsLength(this.data.length)},fe.prototype.write=function(e){let t;for(t=0;t<this.data.length;t++){let a=we.toSJIS(this.data[t]);if(a>=33088&&a<=40956)a-=33088;else{if(!(a>=57408&&a<=60351))throw new Error("Invalid SJIS character: "+this.data[t]+"\nMake sure your charset is UTF-8");a-=49472}a=192*(a>>>8&255)+(255&a),e.put(a,13)}};var ye,Ee=fe,ve={exports:{}};ve.exports=ye={single_source_shortest_paths:function(e,t,a){var o={},n={};n[t]=0;var s,r,i,c,l,d,u,m=ye.PriorityQueue.make();for(m.push(t,0);!m.empty();)for(i in r=(s=m.pop()).value,c=s.cost,l=e[r]||{})l.hasOwnProperty(i)&&(d=c+l[i],u=n[i],(void 0===n[i]||u>d)&&(n[i]=d,m.push(i,d),o[i]=r));if(void 0!==a&&void 0===n[a]){var h=["Could not find a path from ",t," to ",a,"."].join("");throw new Error(h)}return o},extract_shortest_path_from_predecessor_list:function(e,t){for(var a=[],o=t;o;)a.push(o),e[o],o=e[o];return a.reverse(),a},find_path:function(e,t,a){var o=ye.single_source_shortest_paths(e,t,a);return ye.extract_shortest_path_from_predecessor_list(o,a)},PriorityQueue:{make:function(e){var t,a=ye.PriorityQueue,o={};for(t in e=e||{},a)a.hasOwnProperty(t)&&(o[t]=a[t]);return o.queue=[],o.sorter=e.sorter||a.default_sorter,o},default_sorter:function(e,t){return e.cost-t.cost},push:function(e,t){var a={value:e,cost:t};this.queue.push(a),this.queue.sort(this.sorter)},pop:function(){return this.queue.shift()},empty:function(){return 0===this.queue.length}}};var Ne=ve.exports;!function(e){const t=j,a=ie,o=ue,n=ge,s=Ee,r=J,i=N,c=Ne;function l(e){return unescape(encodeURIComponent(e)).length}function d(e,t,a){const o=[];let n;for(;null!==(n=e.exec(a));)o.push({data:n[0],index:n.index,mode:t,length:n[0].length});return o}function u(e){const a=d(r.NUMERIC,t.NUMERIC,e),o=d(r.ALPHANUMERIC,t.ALPHANUMERIC,e);let n,s;i.isKanjiModeEnabled()?(n=d(r.BYTE,t.BYTE,e),s=d(r.KANJI,t.KANJI,e)):(n=d(r.BYTE_KANJI,t.BYTE,e),s=[]);return a.concat(o,n,s).sort((function(e,t){return e.index-t.index})).map((function(e){return{data:e.data,mode:e.mode,length:e.length}}))}function m(e,r){switch(r){case t.NUMERIC:return a.getBitsLength(e);case t.ALPHANUMERIC:return o.getBitsLength(e);case t.KANJI:return s.getBitsLength(e);case t.BYTE:return n.getBitsLength(e)}}function h(e,r){let c;const l=t.getBestModeForData(e);if(c=t.from(r,l),c!==t.BYTE&&c.bit<l.bit)throw new Error('"'+e+'" cannot be encoded with mode '+t.toString(c)+".\n Suggested mode is: "+t.toString(l));switch(c!==t.KANJI||i.isKanjiModeEnabled()||(c=t.BYTE),c){case t.NUMERIC:return new a(e);case t.ALPHANUMERIC:return new o(e);case t.KANJI:return new s(e);case t.BYTE:return new n(e)}}e.fromArray=function(e){return e.reduce((function(e,t){return"string"==typeof t?e.push(h(t,null)):t.data&&e.push(h(t.data,t.mode)),e}),[])},e.fromString=function(a,o){const n=function(e){const a=[];for(let o=0;o<e.length;o++){const n=e[o];switch(n.mode){case t.NUMERIC:a.push([n,{data:n.data,mode:t.ALPHANUMERIC,length:n.length},{data:n.data,mode:t.BYTE,length:n.length}]);break;case t.ALPHANUMERIC:a.push([n,{data:n.data,mode:t.BYTE,length:n.length}]);break;case t.KANJI:a.push([n,{data:n.data,mode:t.BYTE,length:l(n.data)}]);break;case t.BYTE:a.push([{data:n.data,mode:t.BYTE,length:l(n.data)}])}}return a}(u(a,i.isKanjiModeEnabled())),s=function(e,a){const o={},n={start:{}};let s=["start"];for(let r=0;r<e.length;r++){const i=e[r],c=[];for(let e=0;e<i.length;e++){const l=i[e],d=""+r+e;c.push(d),o[d]={node:l,lastCount:0},n[d]={};for(let e=0;e<s.length;e++){const r=s[e];o[r]&&o[r].node.mode===l.mode?(n[r][d]=m(o[r].lastCount+l.length,l.mode)-m(o[r].lastCount,l.mode),o[r].lastCount+=l.length):(o[r]&&(o[r].lastCount=l.length),n[r][d]=m(l.length,l.mode)+4+t.getCharCountIndicator(l.mode,a))}}s=c}for(let t=0;t<s.length;t++)n[s[t]].end=0;return{map:n,table:o}}(n,o),r=c.find_path(s.map,"start","end"),d=[];for(let e=1;e<r.length-1;e++)d.push(s.table[r[e]].node);return e.fromArray(function(e){return e.reduce((function(e,t){const a=e.length-1>=0?e[e.length-1]:null;return a&&a.mode===t.mode?(e[e.length-1].data+=t.data,e):(e.push(t),e)}),[])}(d))},e.rawSplit=function(t){return e.fromArray(u(t,i.isKanjiModeEnabled()))}}(ne);const Ve=N,ke=C,Se=T,Ce=b,xe=I,Te=A,Be=L,be=D,Ie=$,Ae=K,Pe=te,Le=j,De=ne;function Me(e,t,a){const o=e.size,n=Pe.getEncodedBits(t,a);let s,r;for(s=0;s<15;s++)r=1==(n>>s&1),s<6?e.set(s,8,r,!0):s<8?e.set(s+1,8,r,!0):e.set(o-15+s,8,r,!0),s<8?e.set(8,o-s-1,r,!0):s<9?e.set(8,15-s-1+1,r,!0):e.set(8,15-s-1,r,!0);e.set(o-8,8,1,!0)}function _e(e,t,a){const o=new Se;a.forEach((function(t){o.put(t.mode.bit,4),o.put(t.getLength(),Le.getCharCountIndicator(t.mode,e)),t.write(o)}));const n=8*(Ve.getSymbolTotalCodewords(e)-be.getTotalCodewordsCount(e,t));for(o.getLengthInBits()+4<=n&&o.put(0,4);o.getLengthInBits()%8!=0;)o.putBit(0);const s=(n-o.getLengthInBits())/8;for(let r=0;r<s;r++)o.put(r%2?17:236,8);return function(e,t,a){const o=Ve.getSymbolTotalCodewords(t),n=be.getTotalCodewordsCount(t,a),s=o-n,r=be.getBlocksCount(t,a),i=r-o%r,c=Math.floor(o/r),l=Math.floor(s/r),d=l+1,u=c-l,m=new Ie(u);let h=0;const g=new Array(r),p=new Array(r);let w=0;const f=new Uint8Array(e.buffer);for(let V=0;V<r;V++){const e=V<i?l:d;g[V]=f.slice(h,h+e),p[V]=m.encode(g[V]),h+=e,w=Math.max(w,e)}const y=new Uint8Array(o);let E,v,N=0;for(E=0;E<w;E++)for(v=0;v<r;v++)E<g[v].length&&(y[N++]=g[v][E]);for(E=0;E<u;E++)for(v=0;v<r;v++)y[N++]=p[v][E];return y}(o,e,t)}function Ue(e,t,a,o){let n;if(Array.isArray(e))n=De.fromArray(e);else{if("string"!=typeof e)throw new Error("Invalid data");{let o=t;if(!o){const t=De.rawSplit(e);o=Ae.getBestVersionForData(t,a)}n=De.fromString(e,o||40)}}const s=Ae.getBestVersionForData(n,a);if(!s)throw new Error("The amount of data is too big to be stored in a QR Code");if(t){if(t<s)throw new Error("\nThe chosen QR Code version cannot contain this amount of data.\nMinimum version required to store current data is: "+s+".\n")}else t=s;const r=_e(t,a,n),i=Ve.getSymbolSize(t),c=new Ce(i);return function(e,t){const a=e.size,o=Te.getPositions(t);for(let n=0;n<o.length;n++){const t=o[n][0],s=o[n][1];for(let o=-1;o<=7;o++)if(!(t+o<=-1||a<=t+o))for(let n=-1;n<=7;n++)s+n<=-1||a<=s+n||(o>=0&&o<=6&&(0===n||6===n)||n>=0&&n<=6&&(0===o||6===o)||o>=2&&o<=4&&n>=2&&n<=4?e.set(t+o,s+n,!0,!0):e.set(t+o,s+n,!1,!0))}}(c,t),function(e){const t=e.size;for(let a=8;a<t-8;a++){const t=a%2==0;e.set(a,6,t,!0),e.set(6,a,t,!0)}}(c),function(e,t){const a=xe.getPositions(t);for(let o=0;o<a.length;o++){const t=a[o][0],n=a[o][1];for(let a=-2;a<=2;a++)for(let o=-2;o<=2;o++)-2===a||2===a||-2===o||2===o||0===a&&0===o?e.set(t+a,n+o,!0,!0):e.set(t+a,n+o,!1,!0)}}(c,t),Me(c,a,0),t>=7&&function(e,t){const a=e.size,o=Ae.getEncodedBits(t);let n,s,r;for(let i=0;i<18;i++)n=Math.floor(i/3),s=i%3+a-8-3,r=1==(o>>i&1),e.set(n,s,r,!0),e.set(s,n,r,!0)}(c,t),function(e,t){const a=e.size;let o=-1,n=a-1,s=7,r=0;for(let i=a-1;i>0;i-=2)for(6===i&&i--;;){for(let a=0;a<2;a++)if(!e.isReserved(n,i-a)){let o=!1;r<t.length&&(o=1==(t[r]>>>s&1)),e.set(n,i-a,o),s--,-1===s&&(r++,s=7)}if(n+=o,n<0||a<=n){n-=o,o=-o;break}}}(c,r),isNaN(o)&&(o=Be.getBestMask(c,Me.bind(null,c,a))),Be.applyMask(o,c),Me(c,a,o),{modules:c,version:t,errorCorrectionLevel:a,maskPattern:o,segments:n}}v.create=function(e,t){if(void 0===e||""===e)throw new Error("No input text");let a,o,n=ke.M;return void 0!==t&&(n=ke.from(t.errorCorrectionLevel,ke.M),a=Ae.from(t.version),o=Be.from(t.maskPattern),t.toSJISFunc&&Ve.setToSJISFunction(t.toSJISFunc)),Ue(e,a,n,o)};var Re={},Fe={};!function(e){function t(e){if("number"==typeof e&&(e=e.toString()),"string"!=typeof e)throw new Error("Color should be defined as hex string");let t=e.slice().replace("#","").split("");if(t.length<3||5===t.length||t.length>8)throw new Error("Invalid hex color: "+e);3!==t.length&&4!==t.length||(t=Array.prototype.concat.apply([],t.map((function(e){return[e,e]})))),6===t.length&&t.push("F","F");const a=parseInt(t.join(""),16);return{r:a>>24&255,g:a>>16&255,b:a>>8&255,a:255&a,hex:"#"+t.slice(0,6).join("")}}e.getOptions=function(e){e||(e={}),e.color||(e.color={});const a=void 0===e.margin||null===e.margin||e.margin<0?4:e.margin,o=e.width&&e.width>=21?e.width:void 0,n=e.scale||4;return{width:o,scale:o?4:n,margin:a,color:{dark:t(e.color.dark||"#000000ff"),light:t(e.color.light||"#ffffffff")},type:e.type,rendererOpts:e.rendererOpts||{}}},e.getScale=function(e,t){return t.width&&t.width>=e+2*t.margin?t.width/(e+2*t.margin):t.scale},e.getImageWidth=function(t,a){const o=e.getScale(t,a);return Math.floor((t+2*a.margin)*o)},e.qrToImageData=function(t,a,o){const n=a.modules.size,s=a.modules.data,r=e.getScale(n,o),i=Math.floor((n+2*o.margin)*r),c=o.margin*r,l=[o.color.light,o.color.dark];for(let e=0;e<i;e++)for(let a=0;a<i;a++){let d=4*(e*i+a),u=o.color.light;if(e>=c&&a>=c&&e<i-c&&a<i-c){u=l[s[Math.floor((e-c)/r)*n+Math.floor((a-c)/r)]?1:0]}t[d++]=u.r,t[d++]=u.g,t[d++]=u.b,t[d]=u.a}}}(Fe),function(e){const t=Fe;e.render=function(e,a,o){let n=o,s=a;void 0!==n||a&&a.getContext||(n=a,a=void 0),a||(s=function(){try{return document.createElement("canvas")}catch(e){throw new Error("You need to specify a canvas element")}}()),n=t.getOptions(n);const r=t.getImageWidth(e.modules.size,n),i=s.getContext("2d"),c=i.createImageData(r,r);return t.qrToImageData(c.data,e,n),function(e,t,a){e.clearRect(0,0,t.width,t.height),t.style||(t.style={}),t.height=a,t.width=a,t.style.height=a+"px",t.style.width=a+"px"}(i,s,r),i.putImageData(c,0,0),s},e.renderToDataURL=function(t,a,o){let n=o;void 0!==n||a&&a.getContext||(n=a,a=void 0),n||(n={});const s=e.render(t,a,n),r=n.type||"image/png",i=n.rendererOpts||{};return s.toDataURL(r,i.quality)}}(Re);var Oe={};const ze=Fe;function qe(e,t){const a=e.a/255,o=t+'="'+e.hex+'"';return a<1?o+" "+t+'-opacity="'+a.toFixed(2).slice(1)+'"':o}function He(e,t,a){let o=e+t;return void 0!==a&&(o+=" "+a),o}Oe.render=function(e,t,a){const o=ze.getOptions(t),n=e.modules.size,s=e.modules.data,r=n+2*o.margin,i=o.color.light.a?"<path "+qe(o.color.light,"fill")+' d="M0 0h'+r+"v"+r+'H0z"/>':"",c="<path "+qe(o.color.dark,"stroke")+' d="'+function(e,t,a){let o="",n=0,s=!1,r=0;for(let i=0;i<e.length;i++){const c=Math.floor(i%t),l=Math.floor(i/t);c||s||(s=!0),e[i]?(r++,i>0&&c>0&&e[i-1]||(o+=s?He("M",c+a,.5+l+a):He("m",n,0),n=0,s=!1),c+1<t&&e[i+1]||(o+=He("h",r),r=0)):n++}return o}(s,n,o.margin)+'"/>',l='viewBox="0 0 '+r+" "+r+'"',d='<svg xmlns="http://www.w3.org/2000/svg" '+(o.width?'width="'+o.width+'" height="'+o.width+'" ':"")+l+' shape-rendering="crispEdges">'+i+c+"</svg>\n";return"function"==typeof a&&a(null,d),d};const $e=function(){return"function"==typeof Promise&&Promise.prototype&&Promise.prototype.then},Ke=v,je=Re,Qe=Oe;function Je(e,t,a,o,n){const s=[].slice.call(arguments,1),r=s.length,i="function"==typeof s[r-1];if(!i&&!$e())throw new Error("Callback required as last argument");if(!i){if(r<1)throw new Error("Too few arguments provided");return 1===r?(a=t,t=o=void 0):2!==r||t.getContext||(o=a,a=t,t=void 0),new Promise((function(n,s){try{const s=Ke.create(a,o);n(e(s,t,o))}catch(r){s(r)}}))}if(r<2)throw new Error("Too few arguments provided");2===r?(n=a,a=t,t=o=void 0):3===r&&(t.getContext&&void 0===n?(n=o,o=void 0):(n=o,o=a,a=t,t=void 0));try{const s=Ke.create(a,o);n(null,e(s,t,o))}catch(c){n(c)}}Ke.create,Je.bind(null,je.render),Je.bind(null,je.renderToDataURL),Je.bind(null,(function(e,t,a){return Qe.render(e,a)}));const Ye=r({data:()=>({orderNo:"",orderAmount:"",orderName:"",selectedMethod:"alipay",paymentMethods:[{id:"wxpay",name:"微信支付",icon:"images/wxpay.png"},{id:"alipay",name:"支付宝支付",icon:"images/alipay.png"}],showStatus:!1,currentStatus:"等待支付",payUrl:"",queryCount:0,maxQueryCount:60,queryInterval:3e3,payTimer:null,paymentSuccess:!1,countdown:0,countdownTimer:null,qrCodeUrl:"",payForm:"",usedOrderNos:new Set}),onLoad(e){e.orderNo&&e.amount?(this.orderNo=e.orderNo,this.orderAmount=e.amount,this.orderName=decodeURIComponent(e.name||""),this.selectedMethod=e.payType||"alipay",a("log","at pages/payment/index.vue:102","选择的支付方式:",this.selectedMethod,"原始payType:",e.payType),this.$nextTick((()=>{this.handlePay()}))):(uni.showToast({title:"订单信息错误",icon:"none"}),setTimeout((()=>{uni.navigateBack()}),1500))},onUnload(){this.stopQueryPayStatus()},methods:{generateNewOrderNo:()=>Date.now().toString()+Math.floor(1e4*Math.random()).toString().padStart(4,"0"),getValidOrderNo(){if(!this.usedOrderNos.has(this.orderNo))return this.usedOrderNos.add(this.orderNo),this.orderNo;const e=this.generateNewOrderNo();return this.usedOrderNos.add(e),uni.showToast({title:"已重新生成订单号",icon:"none"}),e},quickSelect(e){this.selectedMethod!==e&&(this.selectedMethod=e,this.qrCodeUrl="",this.currentStatus="等待支付",this.handlePay())},async handlePay(){try{uni.showLoading({title:"提交中"});const e={pid:"189092420",out_trade_no:this.getValidOrderNo(),type:"wxpay"===this.selectedMethod?"wxpay":"alipay",notify_url:window.location.origin+"/api/epay/notify",return_url:window.location.origin+"/#/pages/payment/result",name:this.orderName||"商品订单",money:Number(this.orderAmount).toFixed(2),sitename:"情趣优选"},t=await function(e){return n({url:"/epay/getPayLink",method:"GET",params:e})}(e);if(uni.hideLoading(),1!==t.code||!t.data)throw new Error(t.message||"支付失败");t.data.includes('<div class="qrcode">')?(this.parseQrCode(t.data),this.currentStatus=`请使用${"wxpay"===this.selectedMethod?"微信":"支付宝"}扫码支付`):window.location.href=t.data,this.startQueryPayStatus()}catch(e){uni.hideLoading(),a("error","at pages/payment/index.vue:201","支付失败:",e),uni.showToast({title:e.message||"支付失败",icon:"none"})}},startQueryPayStatus(){this.orderNo&&(this.queryCount=0,this.queryPayStatus())},async queryPayStatus(){try{const t=await(e=this.orderNo,n({url:"/epay/queryOrder",method:"GET",params:{outTradeNo:parseInt(e)}}));if(a("log","at pages/payment/index.vue:220","支付状态查询结果:",t),1===t.code&&t.data){const e=t.data.status;"SUCCESS"===e||"已支付"===e?(this.paymentSuccess=!0,this.stopQueryPayStatus(),this.currentStatus="支付成功！正在跳转...",setTimeout((()=>{uni.redirectTo({url:`/pages/payment/result?orderNo=${this.orderNo}&amount=${this.orderAmount}&payType=${this.selectedMethod}&fromPayment=true`})}),1500)):(this.queryCount++,this.queryCount<this.maxQueryCount?this.payTimer=setTimeout((()=>{this.queryPayStatus()}),this.queryInterval):(this.stopQueryPayStatus(),this.currentStatus="支付超时，请重新发起支付"))}}catch(t){a("error","at pages/payment/index.vue:251","查询支付状态失败:",t),this.queryCount++,this.queryCount<this.maxQueryCount?this.payTimer=setTimeout((()=>{this.queryPayStatus()}),this.queryInterval):(this.stopQueryPayStatus(),this.currentStatus="查询支付状态失败，请刷新页面重试")}var e},stopQueryPayStatus(){this.stopCountdown(),this.payTimer&&(clearTimeout(this.payTimer),this.payTimer=null)},startCountdown(){this.stopCountdown(),this.countdown=Math.floor(this.queryInterval/1e3),this.countdownTimer=setInterval((()=>{this.countdown>0?this.countdown--:this.stopCountdown()}),1e3)},stopCountdown(){this.countdownTimer&&(clearInterval(this.countdownTimer),this.countdownTimer=null),this.countdown=0},goBack(){this.paymentSuccess?uni.redirectTo({url:"/pages/order/list"}):uni.navigateBack({delta:1})},onBeforeUnmount(){this.stopQueryPayStatus()},showPayForm(){if(this.payForm){const e=document.createElement("div");e.innerHTML=this.payForm;const t=e.querySelector("img");t&&t.src?(this.qrCodeUrl=t.src,this.showStatus=!0,this.currentStatus=`请使用${"wxpay"===this.selectedMethod?"微信":"支付宝"}扫码完成支付`,this.startQueryPayStatus()):uni.showToast({title:"获取支付二维码失败",icon:"none"})}}}},[["render",function(t,a,o,n,s,r){return e.openBlock(),e.createElementBlock("view",{class:"container"},[e.createElementVNode("view",{class:"order-info"},[e.createElementVNode("view",{class:"amount"},[e.createElementVNode("text",{class:"label"},"支付金额"),e.createElementVNode("text",{class:"value"},"¥"+e.toDisplayString(s.orderAmount),1)]),e.createElementVNode("view",{class:"order-no"},[e.createElementVNode("text",{class:"label"},"订单编号"),e.createElementVNode("text",{class:"value"},e.toDisplayString(s.orderNo),1)])]),e.createElementVNode("view",{class:"payment-methods"},[e.createElementVNode("view",{class:"method-tabs"},[e.createElementVNode("view",{class:e.normalizeClass(["tab-item",{active:"wxpay"===s.selectedMethod}]),onClick:a[0]||(a[0]=e=>r.quickSelect("wxpay"))},[e.createElementVNode("image",{src:"/static/images/wxpay.png",mode:"aspectFit",class:"icon"}),e.createElementVNode("text",null,"微信支付")],2),e.createElementVNode("view",{class:e.normalizeClass(["tab-item",{active:"alipay"===s.selectedMethod}]),onClick:a[1]||(a[1]=e=>r.quickSelect("alipay"))},[e.createElementVNode("image",{src:"/static/images/alipay.png",mode:"aspectFit",class:"icon"}),e.createElementVNode("text",null,"支付宝支付")],2)])]),s.qrCodeUrl?(e.openBlock(),e.createElementBlock("view",{key:0,class:"qr-section"},[e.createElementVNode("view",{class:"qr-wrapper"},[e.createElementVNode("image",{src:s.qrCodeUrl,mode:"aspectFit",class:"qr-image"},null,8,["src"]),e.createElementVNode("view",{class:"qr-tips"},[e.createElementVNode("text",{class:"main-tip"},"请使用"+e.toDisplayString("wxpay"===s.selectedMethod?"微信":"支付宝")+"扫码支付",1),e.createElementVNode("text",{class:"amount"},"¥"+e.toDisplayString(s.orderAmount),1),s.countdown>0?(e.openBlock(),e.createElementBlock("text",{key:0,class:"sub-tip"},e.toDisplayString(s.countdown)+"秒后刷新支付状态",1)):e.createCommentVNode("",!0)])])])):e.createCommentVNode("",!0),s.currentStatus?(e.openBlock(),e.createElementBlock("view",{key:1,class:"status-section"},[e.createElementVNode("text",{class:"status-text"},e.toDisplayString(s.currentStatus),1)])):e.createCommentVNode("",!0)])}]]);const Ge=r({data:()=>({statusList:[{name:"全部",value:""},{name:"待付款",value:"待付款"},{name:"待发货",value:"待发货"},{name:"已发货",value:"已发货"},{name:"已完成",value:"已完成"},{name:"已过期",value:"已过期"}],currentStatus:"",orderList:[],page:1,pageSize:10,hasMore:!0,scrollHeight:0,statusBarHeight:0,navBarHeight:0,menuHeight:44}),onLoad(e){this.currentStatus=e.status||"";const t=uni.getSystemInfoSync();this.statusBarHeight=t.statusBarHeight,this.navBarHeight=this.statusBarHeight+this.menuHeight,this.scrollHeight=t.windowHeight-this.navBarHeight-100,this.loadOrders()},onPullDownRefresh(){this.page=1,this.loadOrders().then((()=>{uni.stopPullDownRefresh()}))},methods:{async loadOrders(){try{uni.showLoading({title:"加载中"});const t=this.currentStatus?await(e=this.currentStatus,n({url:`/order/status/${e}`,method:"GET"})):await n({url:"/order/user/orders",method:"GET"});if(1!==t.code)throw new Error(t.message||"获取订单列表失败");this.orderList=t.data||[]}catch(t){a("error","at pages/order/list.vue:181","获取订单列表失败:",t),uni.showToast({title:t.message||"获取订单列表失败",icon:"none"})}finally{uni.hideLoading()}var e},changeStatus(e){this.currentStatus!==e&&(this.currentStatus=e,this.orderList=[],this.loadOrders())},loadMore(){this.hasMore&&(this.page++,this.loadOrders())},handleDelete(e){uni.showModal({title:"提示",content:"确定要删除该订单吗？",success:async t=>{if(t.confirm)try{1===(await deleteOrder(e.id)).code&&(uni.showToast({title:"删除成功",icon:"success"}),this.page=1,this.loadOrders())}catch(o){a("error","at pages/order/list.vue:226","删除订单失败:",o),uni.showToast({title:"删除失败",icon:"none"})}}})},handleBuyAgain(e){},formatDate(e){if(!e)return"";const t=new Date(e);return`${t.getFullYear()}-${String(t.getMonth()+1).padStart(2,"0")}-${String(t.getDate()).padStart(2,"0")} ${String(t.getHours()).padStart(2,"0")}:${String(t.getMinutes()).padStart(2,"0")}`},getTotalCount:e=>Array.isArray(e)?e.reduce(((e,t)=>e+(t.count||0)),0):0,copyOrderNo(e){uni.setClipboardData({data:e,success:()=>{uni.showToast({title:"订单号已复制",icon:"none"})}})},goBack(){getCurrentPages().length>1?uni.navigateBack():uni.reLaunch({url:"/pages/mall/mall"})},getOrderStatus(e){if("待付款"===e.status){const t=new Date(e.createdAt).getTime();if((new Date).getTime()-t>18e5)return"订单已过期"}return e.status},onBackPress:()=>(uni.reLaunch({url:"/pages/mall/mall"}),!0)},onUnload(){document.documentElement.style.removeProperty("--custom-nav-height")},computed:{statusTabStyle(){return{top:this.navBarHeight+"px"}},listStyle(){return{paddingTop:this.navBarHeight+100+"px"}}}},[["render",function(t,a,o,n,s,r){return e.openBlock(),e.createElementBlock("view",{class:"container"},[e.createElementVNode("view",{class:"custom-nav",style:e.normalizeStyle({height:s.navBarHeight+"px"})},[e.createElementVNode("view",{class:"nav-content",style:e.normalizeStyle({height:s.menuHeight+"px",top:s.statusBarHeight+"px"})},[e.createElementVNode("view",{class:"back-icon",onClick:a[0]||(a[0]=(...e)=>r.goBack&&r.goBack(...e))}),e.createElementVNode("text",{class:"title"},"订单列表")],4)],4),e.createElementVNode("view",{class:"status-tabs",style:e.normalizeStyle(r.statusTabStyle)},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(s.statusList,((t,a)=>(e.openBlock(),e.createElementBlock("view",{class:e.normalizeClass(["tab-item",{active:s.currentStatus===t.value}]),key:a,onClick:e=>r.changeStatus(t.value)},[e.createElementVNode("text",null,e.toDisplayString(t.name),1)],10,["onClick"])))),128))],4),e.createElementVNode("scroll-view",{class:"order-list","scroll-y":"",onScrolltolower:a[1]||(a[1]=(...e)=>r.loadMore&&r.loadMore(...e)),style:e.normalizeStyle(r.listStyle)},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(s.orderList,((t,a)=>(e.openBlock(),e.createElementBlock("view",{class:"order-item",key:a},[e.createElementVNode("view",{class:"order-content"},[e.createElementVNode("view",{class:"shop-info"},[e.createElementVNode("text",{class:"shop-name"},"在线书城"),e.createElementVNode("text",{class:"order-time"},e.toDisplayString(r.formatDate(t.createdAt)),1)]),e.createElementVNode("view",{class:"order-no"},[e.createElementVNode("text",null,"订单编号："),e.createElementVNode("text",{class:"number",onClick:e=>r.copyOrderNo(t.id)},e.toDisplayString(t.id),9,["onClick"]),e.createElementVNode("text",{class:"copy-btn",onClick:e=>r.copyOrderNo(t.id)},"复制",8,["onClick"])]),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(t.products,((t,a)=>(e.openBlock(),e.createElementBlock("view",{class:"product-item",key:a},[e.createElementVNode("image",{src:t.image,mode:"aspectFill",class:"product-image"},null,8,["src"]),e.createElementVNode("view",{class:"product-info"},[e.createElementVNode("text",{class:"product-name"},e.toDisplayString(t.name),1),e.createElementVNode("view",{class:"product-price-wrap"},[e.createElementVNode("text",{class:"product-price"},"¥"+e.toDisplayString(t.price),1),e.createElementVNode("text",{class:"product-count"},"x"+e.toDisplayString(t.count),1)])])])))),128)),e.createElementVNode("view",{class:"delivery-info"},[e.createElementVNode("text",{class:"type"},e.toDisplayString("express"===t.deliveryType?"快递配送":"自提"),1),"express"===t.deliveryType?(e.openBlock(),e.createElementBlock("text",{key:0,class:"address"},e.toDisplayString(t.address),1)):(e.openBlock(),e.createElementBlock("text",{key:1,class:"address"},e.toDisplayString(t.pickupAddress),1))]),e.createElementVNode("view",{class:"order-amount"},[e.createElementVNode("text",null,"共"+e.toDisplayString(r.getTotalCount(t.products))+"件商品",1),e.createElementVNode("text",{class:"amount"},"实付：¥"+e.toDisplayString(t.totalAmount),1)]),e.createElementVNode("view",{class:"order-footer"},[e.createElementVNode("text",{class:"status"},e.toDisplayString(r.getOrderStatus(t)),1),e.createElementVNode("view",{class:"buttons"},["已完成"===t.status?(e.openBlock(),e.createElementBlock("button",{key:0,class:"btn outline",onClick:e=>r.handleBuyAgain(t)},"再次购买",8,["onClick"])):e.createCommentVNode("",!0),"已完成"===t.status?(e.openBlock(),e.createElementBlock("button",{key:1,class:"btn outline",onClick:e=>r.handleDelete(t)},"删除订单",8,["onClick"])):e.createCommentVNode("",!0)])])])])))),128)),s.hasMore?(e.openBlock(),e.createElementBlock("view",{key:0,class:"load-more"},[e.createElementVNode("text",null,"加载中...")])):e.createCommentVNode("",!0),0===s.orderList.length?(e.openBlock(),e.createElementBlock("view",{key:1,class:"empty"},[e.createElementVNode("image",{src:"/static/images/empty-order.png",mode:"aspectFit",class:"empty-image"}),e.createElementVNode("text",null,"暂无相关订单")])):e.createCommentVNode("",!0)],36)])}]]);const We=r({data:()=>({form:{username:"",password:""}}),methods:{async handleLogin(){var e;if(this.form.username&&this.form.password)try{const t=await(e=this.form,n({url:"/user/login",method:"POST",data:e}));if(a("log","at pages/login/login.vue:51","登录响应:",t),1===t.code&&t.data){const{token:e,userId:a,username:o}=t.data;uni.setStorageSync("token",e),uni.setStorageSync("userInfo",{id:a,username:o}),uni.showToast({title:"登录成功",icon:"success"}),setTimeout((()=>{uni.switchTab({url:"/pages/user/user"})}),1500)}else uni.showToast({title:t.message||"登录失败",icon:"none"})}catch(t){a("error","at pages/login/login.vue:80","登录失败:",t),uni.showToast({title:"登录失败",icon:"none"})}else uni.showToast({title:"请输入用户名和密码",icon:"none"})},goRegister(){uni.navigateTo({url:"/pages/register/register"})},goResetPassword(){uni.navigateTo({url:"/pages/reset-password/reset-password"})}}},[["render",function(t,a,o,n,s,r){return e.openBlock(),e.createElementBlock("view",{class:"container"},[e.createElementVNode("view",{class:"form"},[e.createElementVNode("view",{class:"input-group"},[e.withDirectives(e.createElementVNode("input",{type:"text","onUpdate:modelValue":a[0]||(a[0]=e=>s.form.username=e),placeholder:"请输入用户名"},null,512),[[e.vModelText,s.form.username]])]),e.createElementVNode("view",{class:"input-group"},[e.withDirectives(e.createElementVNode("input",{type:"password","onUpdate:modelValue":a[1]||(a[1]=e=>s.form.password=e),placeholder:"请输入密码"},null,512),[[e.vModelText,s.form.password]])]),e.createElementVNode("button",{class:"login-btn",onClick:a[2]||(a[2]=(...e)=>r.handleLogin&&r.handleLogin(...e))},"登录"),e.createElementVNode("view",{class:"actions"},[e.createElementVNode("text",{onClick:a[3]||(a[3]=(...e)=>r.goRegister&&r.goRegister(...e))},"注册账号"),e.createElementVNode("text",{onClick:a[4]||(a[4]=(...e)=>r.goResetPassword&&r.goResetPassword(...e))},"忘记密码")])])])}]]);const Ze=r({data:()=>({addressList:[],loading:!1,isSelectMode:!1}),onLoad(e){this.isSelectMode="true"===e.select,this.getAddresses()},onShow(){this.getAddresses()},methods:{async getAddresses(){if(!this.loading){this.loading=!0,uni.showLoading({title:"加载中"});try{const e=uni.getStorageSync("userInfo");if(!e)return void uni.showToast({title:"请先登录",icon:"none"});const t=await w(e.id);if(1!==t.code)throw new Error(t.message||"获取地址列表失败");this.addressList=(t.data||[]).sort(((e,t)=>e.isDefault&&!t.isDefault?-1:!e.isDefault&&t.isDefault?1:0))}catch(e){a("error","at pages/address/list.vue:89","获取地址列表失败:",e),uni.showToast({title:e.message||"获取地址列表失败",icon:"none"})}finally{this.loading=!1,uni.hideLoading()}}},selectAddress(e){uni.$emit("addressSelected",e),uni.navigateBack()},editAddress(e){uni.navigateTo({url:`/pages/address/edit?id=${e.id}`})},addAddress(){uni.navigateTo({url:"/pages/address/edit"})},async deleteAddress(e){uni.showModal({title:"提示",content:"确定要删除该地址吗？",success:async t=>{if(t.confirm){uni.showLoading({title:"删除中"});try{const t=await(async e=>{try{const t=await n({url:`/userAddress/delete/${e}`,method:"DELETE"});return{code:t.code||1,message:t.message||"success",data:null}}catch(t){return{code:0,message:t.message||"删除地址失败",data:null}}})(e);if(1!==t.code)throw new Error(t.message||"删除失败");this.addressList=this.addressList.filter((t=>t.id!==e)),uni.showToast({title:"删除成功",icon:"success"})}catch(o){a("error","at pages/address/list.vue:146","删除地址失败:",o),uni.showToast({title:o.message||"删除失败",icon:"none"})}finally{uni.hideLoading()}}}})}}},[["render",function(t,a,o,n,s,r){return e.openBlock(),e.createElementBlock("view",{class:"container"},[e.createElementVNode("view",{class:"address-list"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(s.addressList,(t=>(e.openBlock(),e.createElementBlock("view",{class:"address-item",key:t.id,onClick:e=>s.isSelectMode?r.selectAddress(t):null},[e.createElementVNode("view",{class:"info"},[e.createElementVNode("view",{class:"user"},[e.createElementVNode("text",{class:"name"},e.toDisplayString(t.recipientName),1),e.createElementVNode("text",{class:"phone"},e.toDisplayString(t.phone),1)]),e.createElementVNode("view",{class:"address"},e.toDisplayString(t.address),1)]),e.createElementVNode("view",{class:"actions"},[e.createElementVNode("text",{class:"edit",onClick:e.withModifiers((e=>r.editAddress(t)),["stop"])},"编辑",8,["onClick"]),e.createElementVNode("text",{class:"delete",onClick:e.withModifiers((e=>r.deleteAddress(t.id)),["stop"])},"删除",8,["onClick"])])],8,["onClick"])))),128))]),0===s.addressList.length?(e.openBlock(),e.createElementBlock("view",{key:0,class:"empty"},[e.createElementVNode("text",null,"暂无收货地址")])):e.createCommentVNode("",!0),e.createElementVNode("button",{class:"add-btn",onClick:a[0]||(a[0]=(...e)=>r.addAddress&&r.addAddress(...e))},"新增地址")])}]]);const Xe=r({data:()=>({form:{recipientName:"",phone:"",address:"",userId:""},id:null}),onLoad(e){e.id&&(this.id=e.id,this.getDetail());const t=uni.getStorageSync("userInfo");t&&(this.form.userId=t.id)},methods:{async getDetail(){try{const e=await(async e=>{try{const t=await n({url:`/userAddress/findById/${e}`,method:"GET"});return{code:t.code||1,message:t.message||"success",data:t.data||null}}catch(t){return{code:0,message:t.message||"获取地址详情失败",data:null}}})(this.id);1===e.code?this.form=e.data||{}:uni.showToast({title:e.message||"获取地址详情失败",icon:"none"})}catch(e){a("error","at pages/address/edit.vue:74","获取地址详情失败:",e),uni.showToast({title:"获取地址详情失败",icon:"none"})}},async handleSubmit(){if(this.form.recipientName)if(this.form.phone)if(this.form.address)try{const e=this.id?y:f,t=await e(this.form);1===t.code?(uni.showToast({title:this.id?"修改成功":"添加成功",icon:"success"}),setTimeout((()=>{uni.navigateBack()}),1500)):uni.showToast({title:t.message||(this.id?"修改失败":"添加失败"),icon:"none"})}catch(e){a("error","at pages/address/edit.vue:123","保存地址失败:",e),uni.showToast({title:this.id?"修改失败":"添加失败",icon:"none"})}else uni.showToast({title:"请输入详细地址",icon:"none"});else uni.showToast({title:"请输入手机号码",icon:"none"});else uni.showToast({title:"请输入收货人姓名",icon:"none"})}}},[["render",function(t,a,o,n,s,r){return e.openBlock(),e.createElementBlock("view",{class:"container"},[e.createElementVNode("view",{class:"form"},[e.createElementVNode("view",{class:"form-item"},[e.createElementVNode("text",{class:"label"},"收货人"),e.withDirectives(e.createElementVNode("input",{type:"text","onUpdate:modelValue":a[0]||(a[0]=e=>s.form.recipientName=e),placeholder:"请输入收货人姓名"},null,512),[[e.vModelText,s.form.recipientName]])]),e.createElementVNode("view",{class:"form-item"},[e.createElementVNode("text",{class:"label"},"手机号码"),e.withDirectives(e.createElementVNode("input",{type:"number","onUpdate:modelValue":a[1]||(a[1]=e=>s.form.phone=e),placeholder:"请输入手机号码"},null,512),[[e.vModelText,s.form.phone]])]),e.createElementVNode("view",{class:"form-item"},[e.createElementVNode("text",{class:"label"},"详细地址"),e.withDirectives(e.createElementVNode("textarea",{"onUpdate:modelValue":a[2]||(a[2]=e=>s.form.address=e),placeholder:"请输入详细地址"},null,512),[[e.vModelText,s.form.address]])])]),e.createElementVNode("button",{class:"submit-btn",onClick:a[3]||(a[3]=(...e)=>r.handleSubmit&&r.handleSubmit(...e))},"保存")])}]]),et=(e,t=1,a=10)=>{if(!e)throw new Error("搜索关键词不能为空");return n({url:"/products/search",method:"GET",params:{keyword:e.trim(),page:t,size:a}})};const tt=r({data:()=>({keyword:"",products:[],loading:!1,page:1,size:10}),methods:{async handleSearch(){const e=this.keyword.trim();if(e){this.loading=!0;try{const t=await et(e,this.page,this.size);if(a("log","at pages/search/index.vue:75","搜索参数:",{keyword:e,page:this.page,size:this.size}),1!==t.code)throw new Error(t.msg||"搜索失败");this.products=t.data||[],0===this.products.length&&uni.showToast({title:"暂无相关商品",icon:"none"})}catch(t){a("error","at pages/search/index.vue:93","搜索失败:",t),uni.showToast({title:t.message||"搜索失败",icon:"none"})}finally{this.loading=!1}}else uni.showToast({title:"请输入搜索关键词",icon:"none"})},clearKeyword(){this.keyword="",this.products=[]},goDetail(e){uni.navigateTo({url:`/pages/product/detail?id=${e}`})},goBack(){uni.navigateBack()}}},[["render",function(t,a,o,n,s,r){return e.openBlock(),e.createElementBlock("view",{class:"container"},[e.createElementVNode("view",{class:"search-box"},[e.createElementVNode("view",{class:"input-wrap"},[e.withDirectives(e.createElementVNode("input",{type:"text","onUpdate:modelValue":a[0]||(a[0]=e=>s.keyword=e),placeholder:"请输入商品名称",onConfirm:a[1]||(a[1]=(...e)=>r.handleSearch&&r.handleSearch(...e)),"confirm-type":"search",class:"search-input"},null,544),[[e.vModelText,s.keyword]]),s.keyword?(e.openBlock(),e.createElementBlock("text",{key:0,class:"clear-icon",onClick:a[2]||(a[2]=(...e)=>r.clearKeyword&&r.clearKeyword(...e))},"×")):e.createCommentVNode("",!0)]),e.createElementVNode("text",{class:"search-btn",onClick:a[3]||(a[3]=(...e)=>r.handleSearch&&r.handleSearch(...e))},"搜索"),e.createElementVNode("text",{class:"cancel",onClick:a[4]||(a[4]=(...e)=>r.goBack&&r.goBack(...e))},"取消")]),s.products.length>0?(e.openBlock(),e.createElementBlock("view",{key:0,class:"product-list"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(s.products,(t=>(e.openBlock(),e.createElementBlock("view",{class:"product-item",key:t.id,onClick:e=>r.goDetail(t.id)},[e.createElementVNode("image",{src:t.image,mode:"aspectFill",class:"product-image"},null,8,["src"]),e.createElementVNode("view",{class:"product-info"},[e.createElementVNode("text",{class:"product-name"},e.toDisplayString(t.name),1),e.createElementVNode("text",{class:"product-price"},"¥"+e.toDisplayString(t.price),1)])],8,["onClick"])))),128))])):s.keyword&&!s.loading?(e.openBlock(),e.createElementBlock("view",{key:1,class:"empty"},[e.createElementVNode("text",null,"暂无相关商品")])):e.createCommentVNode("",!0)])}]]);const at=r({data:()=>({userInfo:{username:"",phone:"",email:"",avatar:"",nickname:""},notificationEnabled:!0,soundEnabled:!0,cacheSize:"0MB"}),onShow(){this.loadUserInfo(),this.loadSettings(),this.calculateCacheSize()},methods:{async loadUserInfo(){try{const e=await l();if(1!==e.code)throw new Error(e.message||"获取用户信息失败");this.userInfo={...this.userInfo,...e.data}}catch(e){a("error","at pages/user/settings.vue:171","获取用户信息失败:",e),uni.showToast({title:e.message||"获取用户信息失败",icon:"none"})}},loadSettings(){const e=uni.getStorageSync("settings")||{};this.notificationEnabled=!1!==e.notification,this.soundEnabled=!1!==e.sound},calculateCacheSize(){setTimeout((()=>{this.cacheSize="2.5MB"}),500)},navigateTo(e){uni.navigateTo({url:e})},toggleNotification(e){this.notificationEnabled=e.detail.value,this.saveSettings()},toggleSound(e){this.soundEnabled=e.detail.value,this.saveSettings()},saveSettings(){const e={notification:this.notificationEnabled,sound:this.soundEnabled};uni.setStorageSync("settings",e)},clearCache(){uni.showModal({title:"提示",content:"确定要清除缓存吗？",success:e=>{e.confirm&&(uni.showLoading({title:"清理中"}),setTimeout((()=>{uni.hideLoading(),this.cacheSize="0MB",uni.showToast({title:"清除成功",icon:"success"})}),1e3))}})},handleLogout(){uni.showModal({title:"提示",content:"确定要退出登录吗？",success:e=>{e.confirm&&(uni.removeStorageSync("userInfo"),uni.removeStorageSync("token"),uni.removeStorageSync("settings"),uni.reLaunch({url:"/pages/login/index"}))}})}}},[["render",function(t,a,o,n,s,r){return e.openBlock(),e.createElementBlock("view",{class:"container"},[e.createElementVNode("view",{class:"header-bg"},[e.createElementVNode("image",{src:"/static/images/settings-bg.png",mode:"aspectFill"})]),e.createElementVNode("view",{class:"user-card"},[e.createElementVNode("image",{src:s.userInfo.avatar||"/static/images/default-avatar.png",class:"avatar",mode:"aspectFill"},null,8,["src"]),e.createElementVNode("view",{class:"info"},[e.createElementVNode("text",{class:"nickname"},e.toDisplayString(s.userInfo.nickname||s.userInfo.username),1),e.createElementVNode("text",{class:"username"},"账号："+e.toDisplayString(s.userInfo.username),1)])]),e.createElementVNode("view",{class:"settings-list"},[e.createElementVNode("view",{class:"settings-group"},[e.createElementVNode("view",{class:"group-title"},"个人资料"),e.createElementVNode("view",{class:"settings-item",onClick:a[0]||(a[0]=e=>r.navigateTo("/pages/user/profile"))},[e.createElementVNode("view",{class:"item-left"},[e.createElementVNode("text",{class:"iconfont icon-user"}),e.createElementVNode("text",null,"个人信息")]),e.createElementVNode("view",{class:"item-right"},[e.createElementVNode("text",{class:"hint"},"修改头像、昵称等"),e.createElementVNode("text",{class:"iconfont icon-right"})])]),e.createElementVNode("view",{class:"settings-item",onClick:a[1]||(a[1]=e=>r.navigateTo("/pages/address/list"))},[e.createElementVNode("view",{class:"item-left"},[e.createElementVNode("text",{class:"iconfont icon-location"}),e.createElementVNode("text",null,"收货地址")]),e.createElementVNode("view",{class:"item-right"},[e.createElementVNode("text",{class:"iconfont icon-right"})])])]),e.createElementVNode("view",{class:"settings-group"},[e.createElementVNode("view",{class:"group-title"},"安全设置"),e.createElementVNode("view",{class:"settings-item",onClick:a[2]||(a[2]=e=>r.navigateTo("/pages/user/password"))},[e.createElementVNode("view",{class:"item-left"},[e.createElementVNode("text",{class:"iconfont icon-lock"}),e.createElementVNode("text",null,"修改密码")]),e.createElementVNode("view",{class:"item-right"},[e.createElementVNode("text",{class:"iconfont icon-right"})])]),e.createElementVNode("view",{class:"settings-item",onClick:a[3]||(a[3]=e=>r.navigateTo("/pages/user/phone"))},[e.createElementVNode("view",{class:"item-left"},[e.createElementVNode("text",{class:"iconfont icon-phone"}),e.createElementVNode("text",null,"绑定手机")]),e.createElementVNode("view",{class:"item-right"},[e.createElementVNode("text",{class:"hint"},e.toDisplayString(s.userInfo.phone||"未绑定"),1),e.createElementVNode("text",{class:"iconfont icon-right"})])]),e.createElementVNode("view",{class:"settings-item",onClick:a[4]||(a[4]=e=>r.navigateTo("/pages/user/email"))},[e.createElementVNode("view",{class:"item-left"},[e.createElementVNode("text",{class:"iconfont icon-email"}),e.createElementVNode("text",null,"绑定邮箱")]),e.createElementVNode("view",{class:"item-right"},[e.createElementVNode("text",{class:"hint"},e.toDisplayString(s.userInfo.email||"未绑定"),1),e.createElementVNode("text",{class:"iconfont icon-right"})])])]),e.createElementVNode("view",{class:"settings-group"},[e.createElementVNode("view",{class:"group-title"},"通知设置"),e.createElementVNode("view",{class:"settings-item"},[e.createElementVNode("view",{class:"item-left"},[e.createElementVNode("text",{class:"iconfont icon-notification"}),e.createElementVNode("text",null,"推送通知")]),e.createElementVNode("view",{class:"item-right"},[e.createElementVNode("switch",{checked:s.notificationEnabled,onChange:a[5]||(a[5]=(...e)=>r.toggleNotification&&r.toggleNotification(...e)),color:"#FE8C00"},null,40,["checked"])])]),e.createElementVNode("view",{class:"settings-item"},[e.createElementVNode("view",{class:"item-left"},[e.createElementVNode("text",{class:"iconfont icon-sound"}),e.createElementVNode("text",null,"声音提醒")]),e.createElementVNode("view",{class:"item-right"},[e.createElementVNode("switch",{checked:s.soundEnabled,onChange:a[6]||(a[6]=(...e)=>r.toggleSound&&r.toggleSound(...e)),color:"#FE8C00"},null,40,["checked"])])])]),e.createElementVNode("view",{class:"settings-group"},[e.createElementVNode("view",{class:"group-title"},"其他设置"),e.createElementVNode("view",{class:"settings-item",onClick:a[7]||(a[7]=(...e)=>r.clearCache&&r.clearCache(...e))},[e.createElementVNode("view",{class:"item-left"},[e.createElementVNode("text",{class:"iconfont icon-clear"}),e.createElementVNode("text",null,"清除缓存")]),e.createElementVNode("view",{class:"item-right"},[e.createElementVNode("text",{class:"hint"},e.toDisplayString(s.cacheSize),1),e.createElementVNode("text",{class:"iconfont icon-right"})])]),e.createElementVNode("view",{class:"settings-item",onClick:a[8]||(a[8]=e=>r.navigateTo("/pages/about/index"))},[e.createElementVNode("view",{class:"item-left"},[e.createElementVNode("text",{class:"iconfont icon-info"}),e.createElementVNode("text",null,"关于我们")]),e.createElementVNode("view",{class:"item-right"},[e.createElementVNode("text",{class:"iconfont icon-right"})])])]),e.createElementVNode("view",{class:"logout-btn",onClick:a[9]||(a[9]=(...e)=>r.handleLogout&&r.handleLogout(...e))}," 退出登录 ")])])}]]);const ot=r({data:()=>({keyword:"",searchHistory:[],hotSearch:[],suggestList:[],searchResults:[],showResults:!1,loading:!1}),computed:{showEmpty(){return this.showResults&&0===this.searchResults.length&&!this.loading}},created(){this.getHistory(),this.getHotSearch()},methods:{handleInput:function(e,t=300){let a=null;return function(...o){a&&clearTimeout(a),a=setTimeout((()=>{e.apply(this,o),a=null}),t)}}((async function(){if(!this.keyword.trim())return this.suggestList=[],void(this.showResults=!1);try{const e=await et(this.keyword.trim(),1,5);e.data&&(this.suggestList=e.data.map((e=>({id:e.id,name:e.name}))))}catch(e){a("error","at pages/search/search.vue:148","获取搜索建议失败:",e)}}),300),async handleSearch(){if(this.keyword.trim()){this.loading=!0,this.showResults=!0,this.suggestList=[];try{const e=await et(this.keyword.trim(),1,10);e.data&&(this.searchResults=e.data,this.addToHistory(this.keyword.trim()))}catch(e){a("error","at pages/search/search.vue:168","搜索失败:",e),uni.showToast({title:"搜索失败",icon:"none"})}finally{this.loading=!1}}},async getHistory(){try{const e=await n({url:"/search/history",method:"GET"});e.data&&(this.searchHistory=e.data)}catch(e){a("error","at pages/search/search.vue:186","获取搜索历史失败:",e)}},async getHotSearch(){try{const e=await n({url:"/search/hot",method:"GET"});e.data&&(this.hotSearch=e.data)}catch(e){a("error","at pages/search/search.vue:198","获取热门搜索失败:",e)}},async addToHistory(e){try{const t=await(e=>n({url:"/search/history/add",method:"POST",data:{keyword:e}}))(e);0===t.code&&await this.getHistory()}catch(t){a("error","at pages/search/search.vue:210","添加搜索历史失败:",t)}},async clearHistory(){try{0===(await n({url:"/search/history/clear",method:"POST"})).code&&(this.searchHistory=[],uni.showToast({title:"已清空",icon:"success"}))}catch(e){a("error","at pages/search/search.vue:226","清空搜索历史失败:",e)}},useHistoryKeyword(e){this.keyword=e,this.handleSearch()},clearKeyword(){this.keyword="",this.suggestList=[],this.showResults=!1},goDetail(e){uni.navigateTo({url:`/pages/product/detail?id=${e}`})},goBack(){uni.navigateBack()}}},[["render",function(t,a,o,n,s,r){return e.openBlock(),e.createElementBlock("view",{class:"container"},[e.createElementVNode("view",{class:"search-box"},[e.createElementVNode("view",{class:"input-wrap"},[e.createElementVNode("text",{class:"iconfont icon-search"}),e.withDirectives(e.createElementVNode("input",{type:"text","onUpdate:modelValue":a[0]||(a[0]=e=>s.keyword=e),placeholder:"请输入商品名称",onInput:a[1]||(a[1]=(...e)=>r.handleInput&&r.handleInput(...e)),class:"search-input","confirm-type":"search",onConfirm:a[2]||(a[2]=(...e)=>r.handleSearch&&r.handleSearch(...e))},null,544),[[e.vModelText,s.keyword]]),s.keyword?(e.openBlock(),e.createElementBlock("text",{key:0,class:"clear-icon",onClick:a[3]||(a[3]=(...e)=>r.clearKeyword&&r.clearKeyword(...e))},"×")):e.createCommentVNode("",!0)]),e.createElementVNode("text",{class:"cancel",onClick:a[4]||(a[4]=(...e)=>r.goBack&&r.goBack(...e))},"取消")]),!s.keyword&&s.searchHistory.length>0?(e.openBlock(),e.createElementBlock("view",{key:0,class:"history-section"},[e.createElementVNode("view",{class:"section-header"},[e.createElementVNode("text",{class:"title"},"搜索历史"),e.createElementVNode("text",{class:"clear",onClick:a[5]||(a[5]=(...e)=>r.clearHistory&&r.clearHistory(...e))},"清空")]),e.createElementVNode("view",{class:"history-list"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(s.searchHistory,((t,a)=>(e.openBlock(),e.createElementBlock("view",{class:"history-item",key:a,onClick:e=>r.useHistoryKeyword(t)},[e.createElementVNode("text",{class:"iconfont icon-time"}),e.createElementVNode("text",{class:"keyword"},e.toDisplayString(t),1)],8,["onClick"])))),128))])])):e.createCommentVNode("",!0),!s.keyword&&s.hotSearch.length>0?(e.openBlock(),e.createElementBlock("view",{key:1,class:"hot-section"},[e.createElementVNode("view",{class:"section-header"},[e.createElementVNode("text",{class:"title"},"热门搜索")]),e.createElementVNode("view",{class:"hot-list"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(s.hotSearch,((t,a)=>(e.openBlock(),e.createElementBlock("view",{class:"hot-item",key:a,onClick:e=>r.useHistoryKeyword(t)},[e.createElementVNode("text",{class:"keyword"},e.toDisplayString(t),1)],8,["onClick"])))),128))])])):e.createCommentVNode("",!0),s.keyword&&s.suggestList.length>0?(e.openBlock(),e.createElementBlock("view",{key:2,class:"suggest-section"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(s.suggestList,((t,a)=>(e.openBlock(),e.createElementBlock("view",{class:"suggest-item",key:a,onClick:e=>r.useHistoryKeyword(t.name)},[e.createElementVNode("text",{class:"iconfont icon-search"}),e.createElementVNode("text",{class:"name"},e.toDisplayString(t.name),1)],8,["onClick"])))),128))])):e.createCommentVNode("",!0),s.showResults?(e.openBlock(),e.createElementBlock("view",{key:3,class:"result-section"},[e.createElementVNode("view",{class:"product-list"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(s.searchResults,(t=>(e.openBlock(),e.createElementBlock("view",{class:"product-item",key:t.id,onClick:e=>r.goDetail(t.id)},[e.createElementVNode("image",{src:t.image,mode:"aspectFill",class:"product-image"},null,8,["src"]),e.createElementVNode("view",{class:"product-info"},[e.createElementVNode("text",{class:"name"},e.toDisplayString(t.name),1),e.createElementVNode("text",{class:"price"},"¥"+e.toDisplayString(t.price),1)])],8,["onClick"])))),128))])])):e.createCommentVNode("",!0),r.showEmpty?(e.openBlock(),e.createElementBlock("view",{key:4,class:"empty"},[e.createElementVNode("text",null,"暂无相关商品")])):e.createCommentVNode("",!0)])}]]);const nt=r({data:()=>({}),methods:{previewImage(){uni.previewImage({urls:["/static/images/mywx.jpg"],current:0})}}},[["render",function(t,a,o,n,s,r){return e.openBlock(),e.createElementBlock("view",{class:"container"},[e.createElementVNode("view",{class:"header"},[e.createElementVNode("view",{class:"logo-wrapper"},[e.createElementVNode("image",{class:"logo-image",src:"/static/images/heart.png",mode:"aspectFit"})]),e.createElementVNode("text",{class:"title"},"情趣优选"),e.createElementVNode("text",{class:"version"},"v1.0.0")]),e.createElementVNode("view",{class:"content"},[e.createElementVNode("view",{class:"section"},[e.createElementVNode("text",{class:"section-title"},"关于我们"),e.createElementVNode("text",{class:"section-text"},"情趣优选是一家专注于提供优质情趣用品的电商平台。我们致力于为用户提供安全、隐私的购物体验。")]),e.createElementVNode("view",{class:"section"},[e.createElementVNode("text",{class:"section-title"},"我们的优势"),e.createElementVNode("view",{class:"advantages"},[e.createElementVNode("view",{class:"advantage-item"},[e.createElementVNode("text",{class:"iconfont icon-shield"}),e.createElementVNode("text",{class:"name"},"正品保障"),e.createElementVNode("text",{class:"desc"},"所有商品均为正品，假一赔十")]),e.createElementVNode("view",{class:"advantage-item"},[e.createElementVNode("text",{class:"iconfont icon-privacy"}),e.createElementVNode("text",{class:"name"},"隐私配送"),e.createElementVNode("text",{class:"desc"},"无logo包装，全程隐私配送")]),e.createElementVNode("view",{class:"advantage-item"},[e.createElementVNode("text",{class:"iconfont icon-service"}),e.createElementVNode("text",{class:"name"},"专业服务"),e.createElementVNode("text",{class:"desc"},"7x24小时在线客服")]),e.createElementVNode("view",{class:"advantage-item"},[e.createElementVNode("text",{class:"iconfont icon-price"}),e.createElementVNode("text",{class:"name"},"价格优势"),e.createElementVNode("text",{class:"desc"},"品牌直供，价格优惠")])])]),e.createElementVNode("view",{class:"section"},[e.createElementVNode("text",{class:"section-title"},"联系我们"),e.createElementVNode("view",{class:"contact-list"},[e.createElementVNode("view",{class:"contact-item"},[e.createElementVNode("text",{class:"label"},"技术wx："),e.createElementVNode("text",{class:"value"},"EonNetWork")]),e.createElementVNode("view",{class:"contact-item"},[e.createElementVNode("text",{class:"label"},"商务合作："),e.createElementVNode("text",{class:"value"},"shibaizhelianmeng@163.com")]),e.createElementVNode("view",{class:"contact-item"},[e.createElementVNode("text",{class:"label"},"公司："),e.createElementVNode("text",{class:"value"},"远久网络科技")])]),e.createElementVNode("view",{class:"wx-qrcode"},[e.createElementVNode("text",{class:"qrcode-title"},"扫码添加开发者微信"),e.createElementVNode("image",{src:"/static/images/mywx.jpg",mode:"aspectFit",class:"qrcode-image",onClick:a[0]||(a[0]=(...e)=>r.previewImage&&r.previewImage(...e))}),e.createElementVNode("text",{class:"qrcode-tip"},"点击图片可放大查看")])])])])}]]);const st=r({data:()=>({orderNo:"",orderAmount:"",payType:"",payStatus:"",tradeNo:"",sign:"",loading:!1,isPickupDelivery:!1,pickupCode:""}),onLoad(){const e=window.location.hash.split("?")[1];if(e){const t=new URLSearchParams(e);this.orderNo=t.get("out_trade_no")||"",this.orderAmount=t.get("money")||"",this.payType=t.get("type")||"",this.tradeNo=t.get("trade_no")||"",this.payStatus="TRADE_SUCCESS"===t.get("trade_status")?"SUCCESS":"FAIL",this.sign=t.get("sign")||"";const a=t.get("address")||"";a.includes("自提柜取件码：")&&(this.isPickupDelivery=!0,this.pickupCode=a.split("自提柜取件码：")[1]),"SUCCESS"===this.payStatus&&this.isPickupDelivery&&uni.showModal({title:"请保存取件码",content:"请截图保存取件码，凭码到自提柜取件",showCancel:!1,confirmText:"我知道了"}),"SUCCESS"===this.payStatus&&this.handlePaymentNotify()}},methods:{async handlePaymentNotify(){if(!this.loading){this.loading=!0;try{const t=window.location.hash.split("?")[1];if(!t)throw new Error("未获取到支付参数");const o=new URLSearchParams(t),s={pid:o.get("pid"),trade_no:o.get("trade_no"),out_trade_no:o.get("out_trade_no"),type:o.get("type"),name:o.get("name"),money:o.get("money"),trade_status:o.get("trade_status"),sign:o.get("sign"),sign_type:o.get("sign_type"),timestamp:o.get("timestamp"),charset:o.get("charset"),version:o.get("version")};if(Object.keys(s).forEach((e=>{s[e]||delete s[e]})),a("log","at pages/payment/result.vue:157","通知参数:",s),!s.out_trade_no||!s.trade_no||!s.sign)throw new Error("缺少必要的支付参数");a("log","at pages/payment/result.vue:166","支付异步通知结果:",await(e=>{const t=new URLSearchParams;for(const[a,o]of Object.entries(e))o&&t.append(a,o);return n({url:"/epay/notify",method:"POST",data:t.toString(),headers:{"Content-Type":"application/x-www-form-urlencoded"}})})(s));a("log","at pages/payment/result.vue:170","支付同步通知结果:",await(e=>{const t={};for(const[a,o]of Object.entries(e))o&&(t[a]=o);return n({url:"/epay/return",method:"GET",params:t})})(s));const r=await(e=s.out_trade_no,n({url:"/epay/queryOrder",method:"GET",params:{outTradeNo:e}}));if(a("log","at pages/payment/result.vue:174","查询订单状态结果:",r),1!==r.code||!r.data)throw new Error(r.message||"查询订单状态失败");{const e="TRADE_SUCCESS"===r.data.trade_status||"1"===r.data.status||1===r.data.status;if(this.payStatus=e?"SUCCESS":"FAIL",e){const e={status:"已付款",payTime:(new Date).toISOString(),payType:s.type,tradeNo:s.trade_no,payAmount:s.money,payStatus:"SUCCESS"},t=await function(e,t){return n({url:`/order/${e}`,method:"PUT",data:t})}(s.out_trade_no,e);1!==t.code?(a("error","at pages/payment/result.vue:198","更新订单状态失败:",t.message),uni.showToast({title:"更新订单状态失败",icon:"none"})):uni.showToast({title:"支付成功",icon:"success"})}else uni.showToast({title:"支付失败",icon:"none"})}}catch(t){a("error","at pages/payment/result.vue:219","处理支付通知失败:",t),uni.showToast({title:t.message||"处理支付通知失败",icon:"none"}),this.payStatus="FAIL"}finally{this.loading=!1}var e}},goToOrderDetail(){uni.reLaunch({url:"/pages/order/list"})},goToHome(){uni.reLaunch({url:"/pages/mall/mall"})}}},[["render",function(t,a,o,n,s,r){return e.openBlock(),e.createElementBlock("view",{class:"container"},[e.createElementVNode("view",{class:"result-card"},[e.createElementVNode("view",{class:"status-section"},[e.createElementVNode("view",{class:e.normalizeClass(["status-icon",{success:"SUCCESS"===s.payStatus}])},[e.createElementVNode("image",{src:"/static/images/"+("SUCCESS"===s.payStatus?"success.png":"fail.png"),mode:"aspectFit"},null,8,["src"])],2),e.createElementVNode("view",{class:e.normalizeClass(["status-text",{success:"SUCCESS"===s.payStatus}])},e.toDisplayString("SUCCESS"===s.payStatus?"支付成功":"支付失败"),3),e.createElementVNode("view",{class:"status-amount"},[e.createElementVNode("text",{class:"currency"},"¥"),e.createElementVNode("text",{class:"amount"},e.toDisplayString(s.orderAmount),1)])]),"SUCCESS"===s.payStatus&&s.isPickupDelivery?(e.openBlock(),e.createElementBlock("view",{key:0,class:"pickup-code-section"},[e.createElementVNode("view",{class:"pickup-code-title"},"取件码"),e.createElementVNode("view",{class:"pickup-code"},e.toDisplayString(s.pickupCode),1),e.createElementVNode("view",{class:"pickup-tips"},[e.createElementVNode("text",null,"请截图保存取件码"),e.createElementVNode("text",null,"凭此取件码到自提柜取件")])])):e.createCommentVNode("",!0),e.createElementVNode("view",{class:"order-info"},[e.createElementVNode("view",{class:"info-item"},[e.createElementVNode("text",{class:"label"},"订单编号"),e.createElementVNode("text",{class:"value"},e.toDisplayString(s.orderNo),1)]),e.createElementVNode("view",{class:"info-item"},[e.createElementVNode("text",{class:"label"},"支付方式"),e.createElementVNode("text",{class:"value"},[e.createElementVNode("image",{src:"/static/images/"+("alipay"===s.payType?"alipay-small.png":"wxpay-small.png"),mode:"aspectFit",class:"pay-icon"},null,8,["src"]),e.createTextVNode(" "+e.toDisplayString("alipay"===s.payType?"支付宝":"微信支付"),1)])]),e.createElementVNode("view",{class:"info-item"},[e.createElementVNode("text",{class:"label"},"支付时间"),e.createElementVNode("text",{class:"value"},e.toDisplayString((new Date).toLocaleString()),1)])]),e.createElementVNode("view",{class:"actions"},[e.createElementVNode("button",{class:"btn primary",onClick:a[0]||(a[0]=(...e)=>r.goToOrderDetail&&r.goToOrderDetail(...e))},"查看订单"),e.createElementVNode("button",{class:"btn secondary",onClick:a[1]||(a[1]=(...e)=>r.goToHome&&r.goToHome(...e))},"返回首页")])])])}],["__scopeId","data-v-63eae33e"]]);const rt=r({data:()=>({form:{username:"",password:"",confirmPassword:"",email:""}}),methods:{validate(){return this.form.username?this.form.username.length<4||this.form.username.length>20?(uni.showToast({title:"用户名长度为4-20位",icon:"none"}),!1):this.form.password?/^(?=.*[A-Za-z])(?=.*\d)[A-Za-z\d]{6,20}$/.test(this.form.password)?this.form.confirmPassword?this.form.password!==this.form.confirmPassword?(uni.showToast({title:"两次输入的密码不一致",icon:"none"}),!1):this.form.email?!!/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/.test(this.form.email)||(uni.showToast({title:"邮箱格式不正确",icon:"none"}),!1):(uni.showToast({title:"请输入邮箱",icon:"none"}),!1):(uni.showToast({title:"请确认密码",icon:"none"}),!1):(uni.showToast({title:"密码必须包含字母和数字，长度为6-20位",icon:"none"}),!1):(uni.showToast({title:"请输入密码",icon:"none"}),!1):(uni.showToast({title:"请输入用户名",icon:"none"}),!1)},async handleSubmit(){var e;if(this.validate())try{uni.showLoading({title:"注册中"});const t=await(e={username:this.form.username,password:this.form.password,email:this.form.email},n({url:"/user/register",method:"POST",data:e}));if(uni.hideLoading(),1!==t.code)throw new Error(t.message||"注册失败");uni.showToast({title:"注册成功",icon:"success"}),setTimeout((()=>{uni.navigateBack()}),1500)}catch(t){uni.hideLoading(),a("error","at pages/register/register.vue:174","注册失败:",t),uni.showToast({title:t.message||"注册失败",icon:"none"})}},goBack(){uni.navigateBack()}}},[["render",function(t,a,o,n,s,r){return e.openBlock(),e.createElementBlock("view",{class:"container"},[e.createElementVNode("view",{class:"form"},[e.createElementVNode("view",{class:"form-item"},[e.createElementVNode("text",{class:"label"},"用户名"),e.withDirectives(e.createElementVNode("input",{type:"text","onUpdate:modelValue":a[0]||(a[0]=e=>s.form.username=e),placeholder:"请输入用户名","placeholder-class":"placeholder"},null,512),[[e.vModelText,s.form.username]])]),e.createElementVNode("view",{class:"form-item"},[e.createElementVNode("text",{class:"label"},"密码"),e.withDirectives(e.createElementVNode("input",{type:"password","onUpdate:modelValue":a[1]||(a[1]=e=>s.form.password=e),placeholder:"请输入密码","placeholder-class":"placeholder"},null,512),[[e.vModelText,s.form.password]])]),e.createElementVNode("view",{class:"form-item"},[e.createElementVNode("text",{class:"label"},"确认密码"),e.withDirectives(e.createElementVNode("input",{type:"password","onUpdate:modelValue":a[2]||(a[2]=e=>s.form.confirmPassword=e),placeholder:"请再次输入密码","placeholder-class":"placeholder"},null,512),[[e.vModelText,s.form.confirmPassword]])]),e.createElementVNode("view",{class:"form-item"},[e.createElementVNode("text",{class:"label"},"邮箱"),e.withDirectives(e.createElementVNode("input",{type:"text","onUpdate:modelValue":a[3]||(a[3]=e=>s.form.email=e),placeholder:"请输入邮箱","placeholder-class":"placeholder"},null,512),[[e.vModelText,s.form.email]])]),e.createElementVNode("view",{class:"tips"},[e.createElementVNode("text",{class:"tip-item"},"用户名长度为4-20位"),e.createElementVNode("text",{class:"tip-item"},"密码长度为6-20位"),e.createElementVNode("text",{class:"tip-item"},"密码必须包含字母和数字")])]),e.createElementVNode("view",{class:"actions"},[e.createElementVNode("button",{class:"submit-btn",onClick:a[4]||(a[4]=(...e)=>r.handleSubmit&&r.handleSubmit(...e))},"注册"),e.createElementVNode("view",{class:"back-btn",onClick:a[5]||(a[5]=(...e)=>r.goBack&&r.goBack(...e))},"返回登录")])])}]]);const it=r({data:()=>({form:{username:"",email:"",emailCode:"",newPassword:"",confirmPassword:""},counting:!1,countdown:60}),methods:{async sendCode(){if(!this.counting){if(!this.form.username)return uni.showToast({title:"请输入用户名",icon:"none"});if(!this.form.email)return uni.showToast({title:"请输入邮箱",icon:"none"});try{uni.showLoading({title:"发送中"});const e=await c({username:this.form.username,email:this.form.email});if(uni.hideLoading(),1!==e.code)throw new Error(e.message||"发送失败");{uni.showToast({title:"验证码已发送",icon:"success"}),this.counting=!0,this.countdown=60;const e=setInterval((()=>{this.countdown>0?this.countdown--:(this.counting=!1,clearInterval(e))}),1e3)}}catch(e){uni.hideLoading(),a("error","at pages/reset-password/reset-password.vue:148","发送验证码失败:",e),uni.showToast({title:e.message||"发送失败",icon:"none"})}}},async handleSubmit(){if(!this.form.username)return uni.showToast({title:"请输入用户名",icon:"none"});if(!this.form.emailCode)return uni.showToast({title:"请输入验证码",icon:"none"});if(!this.form.newPassword)return uni.showToast({title:"请输入新密码",icon:"none"});if(!this.form.confirmPassword)return uni.showToast({title:"请确认新密码",icon:"none"});if(this.form.newPassword!==this.form.confirmPassword)return uni.showToast({title:"两次输入的密码不一致",icon:"none"});try{uni.showLoading({title:"提交中"});const e=await(e=>{const t=new URLSearchParams;return t.append("username",e.username),t.append("newPassword",e.newPassword),t.append("emailCode",e.emailCode),n({url:"/user/reset-password",method:"POST",data:t.toString(),header:{"Content-Type":"application/x-www-form-urlencoded"}})})({username:this.form.username,newPassword:this.form.newPassword,emailCode:this.form.emailCode});if(uni.hideLoading(),1!==e.code)throw new Error(e.message||"重置失败");uni.showToast({title:"重置成功",icon:"success"}),setTimeout((()=>{uni.navigateBack()}),1500)}catch(e){uni.hideLoading(),a("error","at pages/reset-password/reset-password.vue:220","重置密码失败:",e),uni.showToast({title:e.message||"重置失败",icon:"none"})}},goBack(){uni.navigateBack()}}},[["render",function(t,a,o,n,s,r){return e.openBlock(),e.createElementBlock("view",{class:"container"},[e.createElementVNode("view",{class:"form"},[e.createElementVNode("view",{class:"form-item"},[e.createElementVNode("text",{class:"label"},"用户名"),e.withDirectives(e.createElementVNode("input",{type:"text","onUpdate:modelValue":a[0]||(a[0]=e=>s.form.username=e),placeholder:"请输入用户名","placeholder-class":"placeholder"},null,512),[[e.vModelText,s.form.username]])]),e.createElementVNode("view",{class:"form-item"},[e.createElementVNode("text",{class:"label"},"邮箱"),e.withDirectives(e.createElementVNode("input",{type:"text","onUpdate:modelValue":a[1]||(a[1]=e=>s.form.email=e),placeholder:"请输入邮箱","placeholder-class":"placeholder"},null,512),[[e.vModelText,s.form.email]])]),e.createElementVNode("view",{class:"form-item"},[e.createElementVNode("text",{class:"label"},"验证码"),e.createElementVNode("view",{class:"code-input"},[e.withDirectives(e.createElementVNode("input",{type:"text","onUpdate:modelValue":a[2]||(a[2]=e=>s.form.emailCode=e),placeholder:"请输入验证码","placeholder-class":"placeholder"},null,512),[[e.vModelText,s.form.emailCode]]),e.createElementVNode("text",{class:e.normalizeClass(["code-btn",{disabled:s.counting}]),onClick:a[3]||(a[3]=(...e)=>r.sendCode&&r.sendCode(...e))},e.toDisplayString(s.counting?`${s.countdown}s后重发`:"获取验证码"),3)])]),e.createElementVNode("view",{class:"form-item"},[e.createElementVNode("text",{class:"label"},"新密码"),e.withDirectives(e.createElementVNode("input",{type:"password","onUpdate:modelValue":a[4]||(a[4]=e=>s.form.newPassword=e),placeholder:"请输入新密码","placeholder-class":"placeholder"},null,512),[[e.vModelText,s.form.newPassword]])]),e.createElementVNode("view",{class:"form-item"},[e.createElementVNode("text",{class:"label"},"确认密码"),e.withDirectives(e.createElementVNode("input",{type:"password","onUpdate:modelValue":a[5]||(a[5]=e=>s.form.confirmPassword=e),placeholder:"请再次输入新密码","placeholder-class":"placeholder"},null,512),[[e.vModelText,s.form.confirmPassword]])]),e.createElementVNode("view",{class:"tips"},[e.createElementVNode("text",{class:"tip-item"},"密码长度为6-20位"),e.createElementVNode("text",{class:"tip-item"},"必须包含字母和数字")])]),e.createElementVNode("view",{class:"actions"},[e.createElementVNode("button",{class:"submit-btn",onClick:a[6]||(a[6]=(...e)=>r.handleSubmit&&r.handleSubmit(...e))},"重置密码"),e.createElementVNode("view",{class:"back-btn",onClick:a[7]||(a[7]=(...e)=>r.goBack&&r.goBack(...e))},"返回登录")])])}]]),ct="https://www.zaihui.xyz",lt={__name:"yindao",setup(t){const a=e.ref(0),o=e.ref(""),n=()=>{const e=new URLSearchParams({from:"external",t:Date.now()}),t=`${ct}?${e}`;try{window.open("about:blank").location.href=t}finally{window.location.href=t}},s=async()=>{try{await navigator.clipboard.writeText(ct),o.value="✓ 已复制到剪贴板",a.value=1,setTimeout((()=>a.value=0),1500),setTimeout(n,1e3)}catch{uni.showModal({title:"请手动复制",content:ct,success:n})}};return e.onMounted((()=>{/micromessenger/i.test(navigator.userAgent)||n()})),(t,n)=>(e.openBlock(),e.createElementBlock("view",{class:"guide-container"},[e.createElementVNode("view",{class:"gradient-bg"}),e.createElementVNode("view",{class:"corner-guide"},[e.createElementVNode("view",{class:"guide-icon"},"⬆"),e.createElementVNode("text",{class:"guide-text"},[e.createTextVNode("点击右上角"),e.createElementVNode("br"),e.createTextVNode("选择浏览器打开")])]),e.createElementVNode("view",{class:"content-wrapper"},[e.createElementVNode("view",{class:"emotion-header"},[e.createElementVNode("view",{class:"heartbeat-icon"},"💖"),e.createElementVNode("text",{class:"emotion-title"},"感谢您的热情支持！"),e.createElementVNode("text",{class:"emotion-subtitle"},"您的喜爱让我们既惊喜又惶恐")]),e.createElementVNode("view",{class:"notice-card"},[e.createElementVNode("view",{class:"notice-icon"},"📢"),e.createElementVNode("text",{class:"notice-title"},"访问受限说明"),e.createElementVNode("text",{class:"notice-content"}," 因近期销量很好订单量暴增，微信的访问通道被拦截啦 \\n只能请您通过浏览器继续访问，享受完整服务 \\n给您带来的不便我们深表歉意 ")]),e.createElementVNode("view",{class:"step-cards"},[e.createElementVNode("view",{class:"step-card"},[e.createElementVNode("view",{class:"step-index"},"01"),e.createElementVNode("text",{class:"step-title"},"打开系统菜单"),e.createElementVNode("text",{class:"step-desc"},"点击右上角「···」菜单按钮")]),e.createElementVNode("view",{class:"step-arrow"},"→"),e.createElementVNode("view",{class:"step-card"},[e.createElementVNode("view",{class:"step-index"},"02"),e.createElementVNode("text",{class:"step-title"},"选择浏览器"),e.createElementVNode("text",{class:"step-desc"},"在弹出菜单中选择「在浏览器打开」")])]),e.createElementVNode("view",{class:"domain-card",onClick:s},[e.createElementVNode("view",{class:"domain-meta"},[e.createElementVNode("text",{class:"domain-label"},"点击自动复制安全访问通道 请您浏览器粘贴使用"),e.createElementVNode("text",{class:"domain-value"},"https://www.zaihui.xyz")]),e.createElementVNode("view",{class:"copy-status",style:e.normalizeStyle({opacity:a.value})},e.toDisplayString(o.value),5)]),e.createElementVNode("view",{class:"security-badge"},[e.createElementVNode("view",{class:"ssl-icon"},"🔒"),e.createElementVNode("text",{class:"security-text"},"SSL安全加密 · ICP认证企业")])])]))}};__definePage("pages/mall/mall",i),__definePage("pages/category/category",d),__definePage("pages/cart/cart",h),__definePage("pages/user/user",g),__definePage("pages/product/detail",p),__definePage("pages/order/create",E),__definePage("pages/payment/index",Ye),__definePage("pages/order/list",Ge),__definePage("pages/login/login",We),__definePage("pages/address/list",Ze),__definePage("pages/address/edit",Xe),__definePage("pages/search/index",tt),__definePage("pages/user/settings",at),__definePage("pages/search/search",ot),__definePage("pages/about/index",nt),__definePage("pages/payment/result",st),__definePage("pages/register/register",rt),__definePage("pages/reset-password/reset-password",it),__definePage("pages/yindao/yindao",lt);const dt=Symbol(),ut=Symbol("namespaceContextKey");e.ref(0);const mt=Symbol("zIndexContextKey"),ht=Symbol("localeContextKey"),gt="__epPropKey",pt=(a,o)=>{if(!t.isObject(a)||(n=a,t.isObject(n)&&n[gt]))return a;var n;const{values:s,required:r,default:i,type:c,validator:l}=a,d=s||l?n=>{let r=!1,c=[];if(s&&(c=Array.from(s),t.hasOwn(a,"default")&&c.push(i),r||(r=c.includes(n))),l&&(r||(r=l(n))),!r&&c.length>0){const t=[...new Set(c)].map((e=>JSON.stringify(e))).join(", ");e.warn(`Invalid prop: validation failed${o?` for prop "${o}"`:""}. Expected one of [${t}], got value ${JSON.stringify(n)}.`)}return r}:void 0,u={type:c,required:!!r,validator:d,[gt]:!0};return t.hasOwn(a,"default")&&(u.default=i),u},wt=e=>function(e){for(var t=-1,a=null==e?0:e.length,o={};++t<a;){var n=e[t];o[n[0]]=n[1]}return o}(Object.entries(e).map((([e,t])=>[e,pt(t,e)]))),ft=pt({type:String,values:["","default","small","large"],required:!1}),yt=Symbol("size"),Et=Symbol("emptyValuesContextKey"),vt=wt({emptyValues:Array,valueOnClear:{type:[String,Number,Boolean,Function],default:void 0,validator:e=>t.isFunction(e)?!e():!e}}),Nt=e=>Object.keys(e),Vt=e.ref();const kt=(t,a,o=!1)=>{var n;const s=!!e.getCurrentInstance(),r=s?function(t,a){const o=e.getCurrentInstance()?e.inject(dt,Vt):Vt;return t?e.computed((()=>{var e,n;return null!=(n=null==(e=o.value)?void 0:e[t])?n:a})):o}():void 0,i=null!=(n=null==a?void 0:a.provide)?n:s?e.provide:void 0;if(!i)return;const c=e.computed((()=>{const a=e.unref(t);return(null==r?void 0:r.value)?St(r.value,a):a}));return i(dt,c),i(ht,e.computed((()=>c.value.locale))),i(ut,e.computed((()=>c.value.namespace))),i(mt,e.computed((()=>c.value.zIndex))),i(yt,{size:e.computed((()=>c.value.size||""))}),i(Et,e.computed((()=>({emptyValues:c.value.emptyValues,valueOnClear:c.value.valueOnClear})))),!o&&Vt.value||(Vt.value=c.value),c},St=(e,t)=>{const a=[...new Set([...Nt(e),...Nt(t)])],o={};for(const n of a)o[n]=void 0!==t[n]?t[n]:e[n];return o},Ct=wt({a11y:{type:Boolean,default:!0},locale:{type:Object},size:ft,button:{type:Object},experimentalFeatures:{type:Object},keyboardNavigation:{type:Boolean,default:!0},message:{type:Object},zIndex:Number,namespace:{type:String,default:"el"},...vt}),xt={};const Tt=r({components:{ElConfigProvider:((e,t)=>{if(e.install=a=>{for(const o of[e,...Object.values(null!=t?t:{})])a.component(o.name,o)},t)for(const[a,o]of Object.entries(t))e[a]=o;return e})(e.defineComponent({name:"ElConfigProvider",props:Ct,setup(t,{slots:a}){e.watch((()=>t.message),(e=>{Object.assign(xt,null!=e?e:{})}),{immediate:!0,deep:!0});const o=kt(t);return()=>e.renderSlot(a,"default",{config:null==o?void 0:o.value})}}))},setup:()=>({zhCn:e.ref(null)}),data:()=>({user:null,token:"",cartCount:0,cartList:[],orderList:[],currentOrder:null,productList:[],currentProduct:null,categoryList:[],addressList:[],currentAddress:null,paymentList:[],loading:!1,message:"",messageType:"success"}),onLaunch:function(){a("log","at App.vue:59","App Launch");const e=uni.getSystemInfoSync().statusBarHeight;document.documentElement.style.setProperty("--status-bar-height",`${e}px`)},onShow:function(){a("log","at App.vue:66","App Show")},onHide:function(){a("log","at App.vue:69","App Hide")}},[["render",function(t,a,o,n,s,r){const i=e.resolveComponent("router-view"),c=e.resolveComponent("el-config-provider");return e.openBlock(),e.createBlock(c,{locale:n.zhCn},{default:e.withCtx((()=>[e.createVNode(i)])),_:1},8,["locale"])}]]),Bt=["/pages/login/login","/pages/register/register","/pages/reset-password/reset-password","/pages/yindao/yindao"],bt={timers:new Set,isWeChatBrowser(){return!this.isQQBrowser()&&("complete"===document.readyState&&(this.hasWechatUA()&&this.hasWechatAPI()))},hasWechatUA:()=>/micromessenger/i.test(navigator.userAgent),hasWechatAPI:()=>"undefined"!=typeof WeixinJSBridge,isQQBrowser(){const e=navigator.userAgent;return/(QQBrowser|MQQBrowser|TBS\/[\d.]+)/i.test(e)||navigator.vendor.includes("Tencent")},addTimer(e){this.timers.add(e)},safeClearTimers(){this.timers.forEach((e=>{clearInterval(e),clearTimeout(e)})),this.timers.clear()}},It=()=>{let e=!1;return{invoke:t=>{if(e)return!0;const{url:a}=t;if(e=!0,(e=>{try{const t=new URLSearchParams(e.split("?")[1]);return"external"===t.get("from")&&Date.now()-t.get("t")<6e4}catch{return!1}})(a))return e=!1,!0;if(bt.isQQBrowser())return e=!1,!0;if(bt.isWeChatBrowser())return uni.reLaunch({url:`/pages/yindao/yindao?from=wechat&t=${Date.now()}`}),e=!1,!1;const[o]=a.split("?");return!!Bt.includes(o)||(!!uni.getStorageSync("token")||(uni.redirectTo({url:"/pages/login/login"}),!1))}}},At=()=>{const e=It();uni.addInterceptor("navigateTo",e),uni.addInterceptor("reLaunch",e)};const{app:Pt,Vuex:Lt,Pinia:Dt}=function(){const t=e.createVueApp(Tt);return setTimeout(At,50),{app:t}}();uni.Vuex=Lt,uni.Pinia=Dt,Pt.provide("__globalStyles",__uniConfig.styles),Pt._component.mpType="app",Pt._component.render=()=>{},Pt.mount("#app")}(Vue,uni.VueShared);
