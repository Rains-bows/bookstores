import{u as a,g as t,k as e,v as s,x as o,y as i,z as l,A as c,b as r,w as n,i as d,o as m,d as u,e as f,t as h,j as g,B as p,I as y,C as D,D as I,E as _,p as k}from"./index-ClAhF9Bg.js";import{a as x,u as v,c as C}from"./product.AbqVjqrU.js";import{g as b}from"./category.Dg9eA-eh.js";import{_ as w}from"./_plugin-vue_export-helper.BCo6x5W8.js";import"./request.QWExmb5c.js";const V=w({data:()=>({isEdit:!1,productId:null,categories:[],categoryIndex:0,formData:{name:"",price:"",description:"",stock:0,isActive:!0,image:"",categoryId:null}}),async onLoad(a){await this.loadCategories(),this.categories.length>0&&(this.categoryIndex=0,this.formData.categoryId=this.categories[0].id),a.id&&(this.isEdit=!0,this.productId=parseInt(a.id),this.loadProductDetail())},methods:{async loadCategories(){try{const a=await b();1===a.code&&(this.categories=a.data,!this.isEdit&&this.categories.length>0&&(this.categoryIndex=0,this.formData.categoryId=this.categories[0].id),this.formData.categoryId&&(this.categoryIndex=this.categories.findIndex((a=>a.id===this.formData.categoryId))))}catch(a){e({title:"获取分类列表失败",icon:"none"})}},handleCategoryChange(a){this.categoryIndex=a.detail.value,this.formData.categoryId=this.categories[this.categoryIndex].id,console.log("选择的分类ID:",this.formData.categoryId)},async loadProductDetail(){try{const a=await x(this.productId);if(1===a.code&&a.data){const{name:t,price:e,description:s,stock:o,isActive:i,categoryId:l}=a.data;this.formData={name:t,price:e.toString(),description:s,stock:o,isActive:i,categoryId:l},l&&(this.categoryIndex=this.categories.findIndex((a=>a.id===l)))}else e({title:"获取商品信息失败",icon:"none"})}catch(a){e({title:"获取商品信息失败",icon:"none"})}},handleStatusChange(a){this.formData.isActive=a.detail.value},validateForm(){return this.formData.name.trim()?!this.formData.price||isNaN(this.formData.price)?(e({title:"请输入正确的价格",icon:"none"}),!1):!this.formData.stock||isNaN(this.formData.stock)?(e({title:"请输入正确的库存数量",icon:"none"}),!1):!!this.formData.categoryId||(e({title:"请选择商品分类",icon:"none"}),!1):(e({title:"请输入商品名称",icon:"none"}),!1)},async handleSubmit(){if(this.validateForm())try{const a={...this.formData,price:parseFloat(this.formData.price),stock:parseInt(this.formData.stock),categoryId:this.formData.categoryId};this.isEdit&&(a.id=this.productId);const t=this.isEdit?v:C,o=await t(a);1===o.code?(e({title:this.isEdit?"更新成功":"添加成功",icon:"success"}),setTimeout((()=>{s()}),1500)):e({title:o.message||"操作失败",icon:"none"})}catch(a){e({title:"操作失败",icon:"none"})}},async chooseImage(){try{const c=await o({count:1,sizeType:["compressed"],sourceType:["album","camera"]});if(c.tempFiles.length>0){i({title:"上传中..."});try{const s={path:c.tempFiles[0].path,name:c.tempFiles[0].name||`image_${Date.now()}.jpg`},o=await function(e){return new Promise(((s,o)=>{a({url:"https://lapper.site/api/upload",filePath:e.path,name:"image",formData:{filename:e.name||"image.jpg"},header:{Authorization:t("token")},success:a=>{try{const t=JSON.parse(a.data);s(t)}catch(t){o(new Error("解析响应数据失败"))}},fail:a=>{o(a)}})}))}(s);1===o.code?(this.formData.image=o.data,e({title:"上传成功",icon:"success"})):e({title:"上传失败",icon:"none"})}catch(s){console.error("上传失败:",s),e({title:"上传失败",icon:"none"})}finally{l()}}}catch(s){console.error("选择图片失败:",s)}},previewImage(){this.formData.image&&c({urls:[this.formData.image]})}}},[["render",function(a,t,e,s,o,i){const l=d,c=g,x=p,v=y,C=D,b=I,w=_,V=k;return m(),r(l,{class:"container"},{default:n((()=>[u(l,{class:"tips-box"},{default:n((()=>[u(l,{class:"tips-title"},{default:n((()=>[f("注意事项：")])),_:1}),u(l,{class:"tips-content"},{default:n((()=>[u(c,null,{default:n((()=>[f("1. 商品名称和描述请勿包含色情、暴力等违规内容")])),_:1}),u(c,null,{default:n((()=>[f('2. 建议使用"*"代替敏感词汇')])),_:1}),u(c,null,{default:n((()=>[f("3. 商品描述应当客观真实，避免虚假宣传")])),_:1}),u(c,null,{default:n((()=>[f("4. 上传的图片内容需要合规，禁止违规图片")])),_:1})])),_:1})])),_:1}),u(l,{class:"form"},{default:n((()=>[u(l,{class:"form-item"},{default:n((()=>[u(c,{class:"label"},{default:n((()=>[f("商品图片")])),_:1}),u(l,{class:"upload-box"},{default:n((()=>[o.formData.image?(m(),r(x,{key:0,src:o.formData.image,class:"preview-image",mode:"aspectFit",onClick:i.previewImage},null,8,["src","onClick"])):(m(),r(l,{key:1,class:"upload-btn",onClick:i.chooseImage},{default:n((()=>[u(c,{class:"iconfont icon-add"}),u(c,{class:"upload-text"},{default:n((()=>[f("上传图片")])),_:1})])),_:1},8,["onClick"]))])),_:1})])),_:1}),u(l,{class:"form-item"},{default:n((()=>[u(c,{class:"label"},{default:n((()=>[f("商品名称")])),_:1}),u(v,{type:"text",modelValue:o.formData.name,"onUpdate:modelValue":t[0]||(t[0]=a=>o.formData.name=a),placeholder:"请输入商品名称",class:"input"},null,8,["modelValue"])])),_:1}),u(l,{class:"form-item"},{default:n((()=>[u(c,{class:"label"},{default:n((()=>[f("商品价格")])),_:1}),u(v,{type:"digit",modelValue:o.formData.price,"onUpdate:modelValue":t[1]||(t[1]=a=>o.formData.price=a),placeholder:"请输入商品价格",class:"input"},null,8,["modelValue"])])),_:1}),u(l,{class:"form-item"},{default:n((()=>[u(c,{class:"label"},{default:n((()=>[f("商品库存")])),_:1}),u(v,{type:"number",modelValue:o.formData.stock,"onUpdate:modelValue":t[2]||(t[2]=a=>o.formData.stock=a),placeholder:"请输入商品库存",class:"input"},null,8,["modelValue"])])),_:1}),u(l,{class:"form-item"},{default:n((()=>[u(c,{class:"label"},{default:n((()=>[f("商品描述")])),_:1}),u(C,{modelValue:o.formData.description,"onUpdate:modelValue":t[3]||(t[3]=a=>o.formData.description=a),placeholder:"请输入商品描述",class:"textarea"},null,8,["modelValue"])])),_:1}),u(l,{class:"form-item"},{default:n((()=>[u(c,{class:"label"},{default:n((()=>[f("商品状态")])),_:1}),u(b,{checked:o.formData.isActive,onChange:i.handleStatusChange,color:"#007AFF"},null,8,["checked","onChange"])])),_:1}),u(l,{class:"form-item"},{default:n((()=>[u(c,{class:"label"},{default:n((()=>[f("商品分类")])),_:1}),u(w,{onChange:i.handleCategoryChange,value:o.categoryIndex,range:o.categories,"range-key":"name"},{default:n((()=>[u(l,{class:"picker"},{default:n((()=>{var a;return[f(h((null==(a=o.categories[o.categoryIndex])?void 0:a.name)||"请选择分类"),1)]})),_:1})])),_:1},8,["onChange","value","range"])])),_:1}),u(V,{onClick:i.handleSubmit,class:"submit-btn"},{default:n((()=>[f(h(o.isEdit?"保存":"添加"),1)])),_:1},8,["onClick"])])),_:1})])),_:1})}],["__scopeId","data-v-5b9cf161"]]);export{V as default};
